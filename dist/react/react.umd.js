(function(N,$){typeof exports=="object"&&typeof module<"u"?$(exports,require("react"),require("veaury"),require("vue")):typeof define=="function"&&define.amd?define(["exports","react","veaury","vue"],$):(N=typeof globalThis<"u"?globalThis:N||self,$(N.UEditorPlusDesignerReact={},N.React,N.veaury,N.Vue))})(this,function(N,$,te,t){"use strict";var Uo=Object.defineProperty;var zo=(N,$,te)=>$ in N?Uo(N,$,{enumerable:!0,configurable:!0,writable:!0,value:te}):N[$]=te;var z=(N,$,te)=>zo(N,typeof $!="symbol"?$+"":$,te);var Re={exports:{}},se={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ae;function ot(){if(Ae)return se;Ae=1;var i=$,n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function _(d,l,p){var f,h={},V=null,M=null;p!==void 0&&(V=""+p),l.key!==void 0&&(V=""+l.key),l.ref!==void 0&&(M=l.ref);for(f in l)r.call(l,f)&&!u.hasOwnProperty(f)&&(h[f]=l[f]);if(d&&d.defaultProps)for(f in l=d.defaultProps,l)h[f]===void 0&&(h[f]=l[f]);return{$$typeof:n,type:d,key:V,ref:M,props:h,_owner:s.current}}return se.Fragment=o,se.jsx=_,se.jsxs=_,se}var le={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie;function nt(){return Ie||(Ie=1,process.env.NODE_ENV!=="production"&&function(){var i=$,n=Symbol.for("react.element"),o=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),d=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),M=Symbol.for("react.offscreen"),Y=Symbol.iterator,K="@@iterator";function de(e){if(e===null||typeof e!="object")return null;var a=Y&&e[Y]||e[K];return typeof a=="function"?a:null}var F=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function T(e){{for(var a=arguments.length,c=new Array(a>1?a-1:0),m=1;m<a;m++)c[m-1]=arguments[m];B("error",e,c)}}function B(e,a,c){{var m=F.ReactDebugCurrentFrame,E=m.getStackAddendum();E!==""&&(a+="%s",c=c.concat([E]));var w=c.map(function(v){return String(v)});w.unshift("Warning: "+a),Function.prototype.apply.call(console[e],console,w)}}var S=!1,ne=!1,A=!1,ue=!1,Te=!1,pe;pe=Symbol.for("react.module.reference");function $e(e){return!!(typeof e=="string"||typeof e=="function"||e===r||e===u||Te||e===s||e===p||e===f||ue||e===M||S||ne||A||typeof e=="object"&&e!==null&&(e.$$typeof===V||e.$$typeof===h||e.$$typeof===_||e.$$typeof===d||e.$$typeof===l||e.$$typeof===pe||e.getModuleId!==void 0))}function he(e,a,c){var m=e.displayName;if(m)return m;var E=a.displayName||a.name||"";return E!==""?c+"("+E+")":c}function ge(e){return e.displayName||"Context"}function H(e){if(e==null)return null;if(typeof e.tag=="number"&&T("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case r:return"Fragment";case o:return"Portal";case u:return"Profiler";case s:return"StrictMode";case p:return"Suspense";case f:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case d:var a=e;return ge(a)+".Consumer";case _:var c=e;return ge(c._context)+".Provider";case l:return he(e,e.render,"ForwardRef");case h:var m=e.displayName||null;return m!==null?m:H(e.type)||"Memo";case V:{var E=e,w=E._payload,v=E._init;try{return H(v(w))}catch{return null}}}return null}var q=Object.assign,X=0,ye,ve,Ee,fe,_e,re,U;function be(){}be.__reactDisabledLog=!0;function Ve(){{if(X===0){ye=console.log,ve=console.info,Ee=console.warn,fe=console.error,_e=console.group,re=console.groupCollapsed,U=console.groupEnd;var e={configurable:!0,enumerable:!0,value:be,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}X++}}function Ne(){{if(X--,X===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:q({},e,{value:ye}),info:q({},e,{value:ve}),warn:q({},e,{value:Ee}),error:q({},e,{value:fe}),group:q({},e,{value:_e}),groupCollapsed:q({},e,{value:re}),groupEnd:q({},e,{value:U})})}X<0&&T("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var we=F.ReactCurrentDispatcher,Ce;function g(e,a,c){{if(Ce===void 0)try{throw Error()}catch(E){var m=E.stack.trim().match(/\n( *(at )?)/);Ce=m&&m[1]||""}return`
`+Ce+e}}var b=!1,j;{var Z=typeof WeakMap=="function"?WeakMap:Map;j=new Z}function Q(e,a){if(!e||b)return"";{var c=j.get(e);if(c!==void 0)return c}var m;b=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var w;w=we.current,we.current=null,Ve();try{if(a){var v=function(){throw Error()};if(Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(L){m=L}Reflect.construct(e,[],v)}else{try{v.call()}catch(L){m=L}e.call(v.prototype)}}else{try{throw Error()}catch(L){m=L}e()}}catch(L){if(L&&m&&typeof L.stack=="string"){for(var y=L.stack.split(`
`),O=m.stack.split(`
`),k=y.length-1,x=O.length-1;k>=1&&x>=0&&y[k]!==O[x];)x--;for(;k>=1&&x>=0;k--,x--)if(y[k]!==O[x]){if(k!==1||x!==1)do if(k--,x--,x<0||y[k]!==O[x]){var I=`
`+y[k].replace(" at new "," at ");return e.displayName&&I.includes("<anonymous>")&&(I=I.replace("<anonymous>",e.displayName)),typeof e=="function"&&j.set(e,I),I}while(k>=1&&x>=0);break}}}finally{b=!1,we.current=w,Ne(),Error.prepareStackTrace=E}var ae=e?e.displayName||e.name:"",ee=ae?g(ae):"";return typeof e=="function"&&j.set(e,ee),ee}function C(e,a,c){return Q(e,!1)}function P(e){var a=e.prototype;return!!(a&&a.isReactComponent)}function R(e,a,c){if(e==null)return"";if(typeof e=="function")return Q(e,P(e));if(typeof e=="string")return g(e);switch(e){case p:return g("Suspense");case f:return g("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case l:return C(e.render);case h:return R(e.type,a,c);case V:{var m=e,E=m._payload,w=m._init;try{return R(w(E),a,c)}catch{}}}return""}var J=Object.prototype.hasOwnProperty,W={},Se=F.ReactDebugCurrentFrame;function ke(e){if(e){var a=e._owner,c=R(e.type,e._source,a?a.type:null);Se.setExtraStackFrame(c)}else Se.setExtraStackFrame(null)}function Eo(e,a,c,m,E){{var w=Function.call.bind(J);for(var v in e)if(w(e,v)){var y=void 0;try{if(typeof e[v]!="function"){var O=Error((m||"React class")+": "+c+" type `"+v+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[v]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw O.name="Invariant Violation",O}y=e[v](a,v,m,c,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(k){y=k}y&&!(y instanceof Error)&&(ke(E),T("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",m||"React class",c,v,typeof y),ke(null)),y instanceof Error&&!(y.message in W)&&(W[y.message]=!0,ke(E),T("Failed %s type: %s",c,y.message),ke(null))}}}var _o=Array.isArray;function Pe(e){return _o(e)}function bo(e){{var a=typeof Symbol=="function"&&Symbol.toStringTag,c=a&&e[Symbol.toStringTag]||e.constructor.name||"Object";return c}}function wo(e){try{return He(e),!1}catch{return!0}}function He(e){return""+e}function We(e){if(wo(e))return T("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",bo(e)),He(e)}var Ye=F.ReactCurrentOwner,Co={key:!0,ref:!0,__self:!0,__source:!0},Ke,qe;function So(e){if(J.call(e,"ref")){var a=Object.getOwnPropertyDescriptor(e,"ref").get;if(a&&a.isReactWarning)return!1}return e.ref!==void 0}function ko(e){if(J.call(e,"key")){var a=Object.getOwnPropertyDescriptor(e,"key").get;if(a&&a.isReactWarning)return!1}return e.key!==void 0}function Ro(e,a){typeof e.ref=="string"&&Ye.current}function xo(e,a){{var c=function(){Ke||(Ke=!0,T("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",a))};c.isReactWarning=!0,Object.defineProperty(e,"key",{get:c,configurable:!0})}}function Do(e,a){{var c=function(){qe||(qe=!0,T("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",a))};c.isReactWarning=!0,Object.defineProperty(e,"ref",{get:c,configurable:!0})}}var To=function(e,a,c,m,E,w,v){var y={$$typeof:n,type:e,key:a,ref:c,props:v,_owner:w};return y._store={},Object.defineProperty(y._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(y,"_self",{configurable:!1,enumerable:!1,writable:!1,value:m}),Object.defineProperty(y,"_source",{configurable:!1,enumerable:!1,writable:!1,value:E}),Object.freeze&&(Object.freeze(y.props),Object.freeze(y)),y};function $o(e,a,c,m,E){{var w,v={},y=null,O=null;c!==void 0&&(We(c),y=""+c),ko(a)&&(We(a.key),y=""+a.key),So(a)&&(O=a.ref,Ro(a,E));for(w in a)J.call(a,w)&&!Co.hasOwnProperty(w)&&(v[w]=a[w]);if(e&&e.defaultProps){var k=e.defaultProps;for(w in k)v[w]===void 0&&(v[w]=k[w])}if(y||O){var x=typeof e=="function"?e.displayName||e.name||"Unknown":e;y&&xo(v,x),O&&Do(v,x)}return To(e,y,O,E,m,Ye.current,v)}}var Oe=F.ReactCurrentOwner,Je=F.ReactDebugCurrentFrame;function ie(e){if(e){var a=e._owner,c=R(e.type,e._source,a?a.type:null);Je.setExtraStackFrame(c)}else Je.setExtraStackFrame(null)}var Le;Le=!1;function je(e){return typeof e=="object"&&e!==null&&e.$$typeof===n}function Ge(){{if(Oe.current){var e=H(Oe.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Vo(e){return""}var Xe={};function No(e){{var a=Ge();if(!a){var c=typeof e=="string"?e:e.displayName||e.name;c&&(a=`

Check the top-level render call using <`+c+">.")}return a}}function Ze(e,a){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var c=No(a);if(Xe[c])return;Xe[c]=!0;var m="";e&&e._owner&&e._owner!==Oe.current&&(m=" It was passed a child from "+H(e._owner.type)+"."),ie(e),T('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',c,m),ie(null)}}function Qe(e,a){{if(typeof e!="object")return;if(Pe(e))for(var c=0;c<e.length;c++){var m=e[c];je(m)&&Ze(m,a)}else if(je(e))e._store&&(e._store.validated=!0);else if(e){var E=de(e);if(typeof E=="function"&&E!==e.entries)for(var w=E.call(e),v;!(v=w.next()).done;)je(v.value)&&Ze(v.value,a)}}}function Po(e){{var a=e.type;if(a==null||typeof a=="string")return;var c;if(typeof a=="function")c=a.propTypes;else if(typeof a=="object"&&(a.$$typeof===l||a.$$typeof===h))c=a.propTypes;else return;if(c){var m=H(a);Eo(c,e.props,"prop",m,e)}else if(a.PropTypes!==void 0&&!Le){Le=!0;var E=H(a);T("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",E||"Unknown")}typeof a.getDefaultProps=="function"&&!a.getDefaultProps.isReactClassApproved&&T("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Oo(e){{for(var a=Object.keys(e.props),c=0;c<a.length;c++){var m=a[c];if(m!=="children"&&m!=="key"){ie(e),T("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",m),ie(null);break}}e.ref!==null&&(ie(e),T("Invalid attribute `ref` supplied to `React.Fragment`."),ie(null))}}var et={};function tt(e,a,c,m,E,w){{var v=$e(e);if(!v){var y="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(y+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var O=Vo();O?y+=O:y+=Ge();var k;e===null?k="null":Pe(e)?k="array":e!==void 0&&e.$$typeof===n?(k="<"+(H(e.type)||"Unknown")+" />",y=" Did you accidentally export a JSX literal instead of a component?"):k=typeof e,T("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",k,y)}var x=$o(e,a,c,E,w);if(x==null)return x;if(v){var I=a.children;if(I!==void 0)if(m)if(Pe(I)){for(var ae=0;ae<I.length;ae++)Qe(I[ae],e);Object.freeze&&Object.freeze(I)}else T("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Qe(I,e)}if(J.call(a,"key")){var ee=H(e),L=Object.keys(a).filter(function(Mo){return Mo!=="key"}),Be=L.length>0?"{key: someKey, "+L.join(": ..., ")+": ...}":"{key: someKey}";if(!et[ee+Be]){var Io=L.length>0?"{"+L.join(": ..., ")+": ...}":"{}";T(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Be,ee,Io,ee),et[ee+Be]=!0}}return e===r?Oo(x):Po(x),x}}function Lo(e,a,c){return tt(e,a,c,!0)}function jo(e,a,c){return tt(e,a,c,!1)}var Bo=jo,Ao=Lo;le.Fragment=r,le.jsx=Bo,le.jsxs=Ao}()),le}process.env.NODE_ENV==="production"?Re.exports=ot():Re.exports=nt();var rt=Re.exports;const Me="https://paiban.tecmz.com/api/live_rich_editor";async function it(){var i;try{const n=await fetch(`${Me}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();if(o.code!==0||!((i=o.data)!=null&&i.tree))throw new Error(o.msg||"Failed to fetch categories");return Ue(o.data.tree)}catch(n){return console.error("Failed to fetch categories:",n),[]}}function Ue(i){return i.map(n=>({id:n.id,title:n.title,pid:n.pid,sort:n.sort||0,_child:n._child?Ue(n._child):void 0}))}async function at(i){try{const n={paginate:{page:(i==null?void 0:i.page)||1,pageSize:(i==null?void 0:i.pageSize)||100,search:{}}};i!=null&&i.categoryId&&(n.paginate.search.categoryId=i.categoryId),i!=null&&i.keywords&&(n.paginate.search.keywords=i.keywords);const o=await fetch(`${Me}/paginate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const r=await o.json();if(r.code!==0||!r.data)throw new Error(r.msg||"Failed to fetch materials");return r.data}catch(n){return console.error("Failed to fetch materials:",n),{page:1,pageSize:(i==null?void 0:i.pageSize)||10,total:0,records:[]}}}function st(i){return i.map(n=>({...n,id:n.id,title:n.title,html:n.html}))}async function lt(){try{return await it()}catch(i){return console.error("Default category loader error:",i),[]}}async function ct(i){try{const n=await at(i);return{records:st(n.records),total:n.total,page:n.page,pageSize:n.pageSize}}catch(n){return console.error("Default style loader error:",n),{records:[],total:0,page:1,pageSize:(i==null?void 0:i.pageSize)||100}}}const D={SectionClass:"pb-section",SectionActiveClass:"pb-section-active",SectionHoverClass:"pb-section-hover",DefaultCategoryLoader:lt,DefaultStyleLoader:ct},dt=[["source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","insertimage","emotion","scrawl","insertvideo","attachment","map","insertframe","insertcode","pagebreak","template","background","|","horizontal","date","time","spechars","wordimage","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","print","preview","searchreplace","shortcutmenu"]];let ce=!1,ze=!1;const xe=[];function ut(i="/ueditor-plus"){return new Promise((n,o)=>{if(ze&&window.UE){n(window.UE);return}if(ce){xe.push(()=>n(window.UE));return}ce=!0;const r=i.endsWith("/")?i:`${i}/`;window.UEDITOR_HOME_URL=r;const s=document.createElement("script");s.src=`${r}ueditor.config.js`,s.onload=()=>{const u=document.createElement("script");u.src=`${r}ueditor.all.js`,u.onload=()=>{ze=!0,ce=!1,xe.forEach(_=>_()),xe.length=0,n(window.UE)},u.onerror=()=>{ce=!1,o(new Error("Failed to load UEditor main script"))},document.head.appendChild(u)},s.onerror=()=>{ce=!1,o(new Error("Failed to load UEditor config script"))},document.head.appendChild(s)})}const ft=`
/* Section基础样式 */
section.pb-section {
  position: relative;
  margin: 10px auto;
  padding: 0;
  transition: all 0.2s;
  cursor: pointer;
  min-height: 20px;
}

/* Section激活状态 */
section.pb-section.pb-section-active {
  outline: 2px dashed rgba(255, 0, 0, 0.4);
  outline-offset: 2px;
}

/* 子Section悬停状态 */
section.pb-section .pb-section-hover {
  outline: 1px dashed rgba(0, 0, 255, 0.3);
  outline-offset: 1px;
}

/* 子Section激活状态 */
section.pb-section .pb-section-active {
  outline: 1px dashed rgba(0, 0, 255, 0.5);
  outline-offset: 1px;
}

/* 子Section样式 */
section:not(.pb-section) {
  position: relative;
  transition: all 0.2s;
}

section:not(.pb-section).pb-section-hover {
  outline: 1px dashed rgba(0, 0, 255, 0.3);
  outline-offset: 1px;
}

/* 图片样式增强 */
section.pb-section img {
  max-width: 100%;
  height: auto;
  display: block;
  transition: all 0.2s;
}

section.pb-section img:hover {
  opacity: 0.9;
  cursor: pointer;
}

/* 表格样式优化 */
section.pb-section table {
  border-collapse: collapse;
  width: 100%;
  margin: 10px 0;
}

section.pb-section table td,
section.pb-section table th {
  border: 1px solid #ddd;
  padding: 8px;
}

section.pb-section table th {
  background: #f5f5f5;
  font-weight: bold;
}

/* 防止内容溢出 */
section.pb-section {
  overflow: hidden;
  word-wrap: break-word;
}

/* 空Section提示 */
section.pb-section:empty::before {
  content: '空内容块 - 点击编辑';
  color: #999;
  font-size: 14px;
}
`;class mt{constructor(n){z(this,"config");z(this,"container",null);z(this,"editor",null);z(this,"editorId");z(this,"eventHandlers",new Map);z(this,"resizeHandler",null);z(this,"editorElement",null);const o=n.ueditorConfig||{};o.iframeCssStylesAddition||(o.iframeCssStylesAddition=[]),o.iframeCssStylesAddition=[ft,...o.iframeCssStylesAddition],o.toolbars||(o.toolbars=dt),o.toolbars[o.toolbars.length-1].push("liveeditor");let r=n.categoryLoader||D.DefaultCategoryLoader,s=n.styleLoader||D.DefaultStyleLoader;this.config={container:n.container||"#editor",ueditorPath:n.ueditorPath||"/ueditor-plus",ueditorConfig:o,categoryLoader:r,styleLoader:s,onReady:n.onReady||(()=>{}),onChange:n.onChange||(()=>{})},this.editorId=`ueditorPlusDesigner_${Date.now()}`}async init(){if(typeof this.config.container=="string"?this.container=document.querySelector(this.config.container):this.container=this.config.container,!this.container)throw new Error("Container not found");await ut(this.config.ueditorPath);const n=window.UE;if(!n)throw new Error("UEditor failed to load");const o=document.createElement("div");o.id=this.editorId,this.container.appendChild(o),this.editorElement=o,this.registerUIPlugin();const r={autoHeightEnabled:!1,initialFrameWidth:"100%",...this.config.ueditorConfig};this.editor=n.getEditor(this.editorId,r),this.editor.ready(()=>{this.setupResizeListener(),this.doLayout(),this.config.onReady(),this.emit("ready")}),this.editor.addListener("contentChange",()=>{const s=this.getContent();this.config.onChange(s),this.emit("change",s)})}registerUIPlugin(){window.UE.registerUI("liveeditor",(o,r)=>{o.on("click",(s,u)=>{const _=u.target,d=_.closest(`.${D.SectionClass}`);if(!d||(o.document.querySelectorAll(`.${D.SectionClass}`).forEach(V=>{V.classList.remove(D.SectionActiveClass)}),d.classList.add(D.SectionActiveClass),o.selection.getText()))return;let f=null;const h=o.selection.getRange().getClosedNode();h&&h.tagName&&h.tagName.toLowerCase()==="img"&&(f=h),this.emit("section-click",{section:d,element:_,image:f})}),o.addListener("mouseover mouseout",(s,u)=>{const _=u.target;if(o.document.querySelectorAll(`section:not(.${D.SectionClass})`).forEach(l=>{l.classList.remove(D.SectionHoverClass)}),!_.classList.contains(D.SectionClass)){const l=_.closest(`section:not(.${D.SectionClass})`);s==="mouseover"&&l&&l.classList.add(D.SectionHoverClass)}})})}getContent(){var n;return((n=this.editor)==null?void 0:n.getContent())||""}setContent(n){var o;(o=this.editor)==null||o.setContent(n)}insertSection(n,o){if(!this.editor)return;const r=(o==null?void 0:o.id)||"",s=`<section class="${D.SectionClass} ${D.SectionActiveClass}" data-section-id="${r}">${n}</section>`;this.editor.execCommand("insertHtml",s)}doLayout(){if(!this.container||!this.editor||!this.editorElement)return;const n=this.container.clientHeight,o=this.editorElement.querySelector(".edui-editor-toolbarbox"),r=o?o.offsetHeight:0,s=n-r;this.editor.setHeight(Math.max(s,100))}setupResizeListener(){let n=null;this.resizeHandler=()=>{n!==null&&window.clearTimeout(n),n=window.setTimeout(()=>{this.doLayout()},150)},window.addEventListener("resize",this.resizeHandler)}destroy(){var n;this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),(n=this.editor)==null||n.destroy(),this.editor=null,this.eventHandlers.clear()}on(n,o){this.eventHandlers.has(n)||this.eventHandlers.set(n,[]),this.eventHandlers.get(n).push(o)}off(n,o){if(!o){this.eventHandlers.delete(n);return}const r=this.eventHandlers.get(n);if(r){const s=r.indexOf(o);s>-1&&r.splice(s,1)}}emit(n,...o){const r=this.eventHandlers.get(n);r&&r.forEach(s=>s(...o))}getEditor(){return this.editor}}function pt(i){const n=t.ref([]),o=t.ref([]),r=t.ref(0),s=t.ref(!1),u=t.ref(!1),_=t.ref(!1),d=t.ref(0),l=t.ref(""),p=t.ref(1),f=t.ref(100),h=t.ref(!0),V=()=>i.categoryLoader?i.categoryLoader:D.DefaultCategoryLoader,M=()=>i.styleLoader?i.styleLoader:D.DefaultStyleLoader,Y=async()=>{const B=V();if(B){_.value=!0;try{n.value=await B()}catch(S){console.error("Failed to load categories:",S),n.value=[]}finally{_.value=!1}}},K=async(B,S=!1)=>{const ne=M();if(ne){S?u.value=!0:s.value=!0;try{const A=await ne({categoryId:d.value,keywords:l.value,page:p.value,pageSize:f.value,...B});S?o.value=[...o.value,...A.records]:o.value=A.records,r.value=A.total,f.value=A.pageSize;const ue=Math.ceil(A.total/f.value);h.value=p.value<ue}catch(A){console.error("Failed to load materials:",A),S||(o.value=[],r.value=0,h.value=!1)}finally{S?u.value=!1:s.value=!1}}},de=async()=>{u.value||!h.value||(p.value++,await K(void 0,!0))},F=B=>{d.value=B,p.value=1,h.value=!0,K()},T=B=>{l.value=B,p.value=1,h.value=!0,K()};return t.onMounted(async()=>{await Y(),await K()}),{categories:n,materials:o,total:r,loading:s,loadingMore:u,loadingCategories:_,currentCategory:d,keywords:l,currentPage:p,hasMore:h,loadMaterials:K,loadMore:de,changeCategory:F,search:T}}const oe=class oe{constructor(){z(this,"element",null);z(this,"styles",{})}dom(n){return this.element=n,this.parse(),this}parse(){if(this.styles={},!this.element)return this;const n=this.element.getAttribute("style");if(n){const o=n.split(";");for(const r of o){if(!r.trim())continue;const[s,u]=r.split(":").map(_=>_.trim());s&&u&&(this.styles[s]=u)}}return this}remove(n){return n in this.styles&&delete this.styles[n],this}removeDomAttr(n){var o;return(o=this.element)==null||o.removeAttribute(n),this}getStyleKeys(n){const o=[];for(const r of oe.prefixes){const s=`${r}${n}`;if(s in this.styles){o.push(s);break}}return o.length?o:[n]}setStyleValues(n,o){const r=this.getStyleKeys(n);if(!r.length)this.styles[n]=o("");else for(const s of r){const u=this.styles[s]||"";this.styles[s]=o(u)}}merge(n,o){if(n==="rotatez"){const r=`rotatez(${o}deg)`;this.setStyleValues("transform",s=>/rotatez\(.*?\)/.test(s)?s.replace(/rotatez\(.*?\)/,r):s?`${s} ${r}`:r)}else{this.styles[n]=String(o);for(const r of oe.prefixes){const s=`${r}${n}`;s in this.styles&&(this.styles[s]=String(o))}}return this}get(n,o=null){if(!this.element)return o;switch(n){case"opacity":{let r=this.element.style.opacity;if(!r)for(const s of oe.prefixes){const u=`${s}${n}`;if(u in this.styles){r=this.styles[u];break}}return r?parseFloat(r):o}case"rotatez":{const r=this.element.style.transform||"";let s=0;if(r.toLowerCase().indexOf("rotatez(")>=0){const u=r.toLowerCase().replace(/rotatex\s*\(\s*[0-9\-]*\s*deg\s*\)/g,"").replace(/rotatey\s*\(\s*[0-9\-]*\s*deg\s*\)/g,"").match(/rotatez\s*\(\s*([0-9\-]+)\s*deg\s*\)/);u&&(s=parseInt(u[1]),s>180?s-=360:s<-180&&(s+=360))}return s}default:return this.styles[n]||o}}toDom(){if(!this.element)return this;const n=[];for(const o in this.styles)n.push(`${o}:${this.styles[o]}`);return n.length?this.element.setAttribute("style",n.join(";")):this.element.removeAttribute("style"),this}};z(oe,"prefixes",["-moz-","-o-","-webkit-","-ms-"]);let De=oe;const G={fromDom(i){return new De().dom(i)}};function ht(){const i=t.ref(null),n=t.ref(null),o=t.ref({id:"",width:100,rotate:0,opacity:1}),r=t.ref({show:!1,element:null,width:100,opacity:1}),s=d=>{i.value=d,o.value.id=d.getAttribute("data-section-id")||"";const l=G.fromDom(d),p=d.style.width||"100%";o.value.width=parseInt(p)||100,o.value.rotate=l.get("rotatez",0),o.value.opacity=l.get("opacity",1)},u=(d,l)=>{r.value.element=l,r.value.show=!0,i.value=d;const p=G.fromDom(l),f=l.style.width||"100%";r.value.width=parseInt(f)||100,r.value.opacity=p.get("opacity",1)},_=()=>{i.value=null,n.value=null,r.value.show=!1,r.value.element=null};return t.watch(()=>o.value.width,d=>{i.value&&G.fromDom(i.value).merge("margin","0 auto").merge("width",`${d}%`).toDom().remove("max-width").removeDomAttr("width")}),t.watch(()=>o.value.rotate,d=>{i.value&&G.fromDom(i.value).merge("rotatez",d).toDom()}),t.watch(()=>o.value.opacity,d=>{i.value&&G.fromDom(i.value).merge("opacity",d).toDom()}),t.watch(()=>r.value.width,d=>{r.value.element&&G.fromDom(r.value.element).remove("max-width").merge("width",`${d}%`).toDom().removeDomAttr("width")}),t.watch(()=>r.value.opacity,d=>{r.value.element&&G.fromDom(r.value.element).merge("opacity",d).toDom()}),{currentSection:i,currentElement:n,sectionData:o,imageData:r,prepareSectionStyle:s,prepareImageStyle:u,clearSelection:_}}function gt(){const i=(d,l)=>{d&&(d.undoManger.save(),l(),d.undoManger.save(),d.syncCommandState())};return{clearSectionFormat:(d,l)=>{!d||!l||i(d,()=>{d.selection.getRange().selectNode(l).select(),d.execCommand("removeformat"),l.className=`${D.SectionClass} ${D.SectionActiveClass}`})},insertSection:(d,l,p)=>{if(!d||!l)return;const f=document.createElement("section");f.className=D.SectionClass,f.setAttribute("data-section-id","");const h=document.createElement("p"),V=document.createElement("br");h.appendChild(V),f.appendChild(h),i(d,()=>{var M,Y;p==="before"?(M=l.parentNode)==null||M.insertBefore(f,l):(Y=l.parentNode)==null||Y.insertBefore(f,l.nextSibling)}),d.selection.getRange().setStart(h,0).setCursor(!1,!0)},selectSection:(d,l)=>{!d||!l||i(d,()=>{d.selection.getRange().selectNode(l).select()})},deleteSection:(d,l)=>{!d||!l||i(d,()=>{l.remove()})},moveSectionUp:(d,l)=>{if(!d||!l)return;const p=l.previousElementSibling;p&&i(d,()=>{var f;(f=l.parentNode)==null||f.insertBefore(l,p)})},moveSectionDown:(d,l)=>{if(!d||!l)return;const p=l.nextElementSibling;p&&i(d,()=>{var f;(f=l.parentNode)==null||f.insertBefore(l,p.nextSibling)})}}}const yt={class:"upd-material-panel"},vt={class:"upd-material-body"},Et={class:"upd-material-item"},_t={class:"upd-material-item__head"},bt={class:"upd-category"},wt={class:"upd-category__item"},Ct=["onClick"],St={key:0,class:"upd-category__children"},kt=["onClick"],Rt={class:"upd-filter"},xt={class:"upd-filter__search"},Dt={class:"upd-material-item__body"},Tt={key:0,class:"upd-loading"},$t={key:1,class:"upd-material-list"},Vt=["onClick"],Nt=["innerHTML"],Pt={class:"upd-material-list__info"},Ot={class:"upd-material-list__title"},Lt={class:"upd-material-list__id"},jt={key:0,class:"upd-loading-more"},Bt={key:1,class:"upd-no-more"},At=t.defineComponent({__name:"MaterialPanel",props:{categories:{},materials:{},total:{},currentCategory:{},loading:{type:Boolean,default:!1},loadingMore:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0}},emits:["select","change-category","search","load-more"],setup(i,{emit:n}){const o=i,r=n,s=t.ref(""),u=t.ref(null),_=()=>{r("search",s.value)},d=()=>{if(!u.value||o.loading||o.loadingMore||!o.hasMore)return;const l=u.value,p=l.scrollTop,f=l.scrollHeight,h=l.clientHeight;p+h>=f-50&&r("load-more")};return t.onMounted(()=>{u.value=document.querySelector(".upd-material-item"),u.value&&u.value.addEventListener("scroll",d)}),t.onUnmounted(()=>{u.value&&u.value.removeEventListener("scroll",d)}),(l,p)=>(t.openBlock(),t.createElementBlock("div",yt,[t.createElementVNode("div",vt,[t.createElementVNode("div",Et,[t.createElementVNode("div",_t,[t.createElementVNode("div",bt,[t.createElementVNode("div",wt,[t.createElementVNode("div",{class:t.normalizeClass(["upd-category__title",{"upd-category__title--active":i.currentCategory===0}]),onClick:p[0]||(p[0]=f=>l.$emit("change-category",0))}," 全部 ",2)]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.categories,f=>(t.openBlock(),t.createElementBlock("div",{key:f.id,class:"upd-category__item"},[t.createElementVNode("div",{class:t.normalizeClass(["upd-category__title",{"upd-category__title--active":f.id===i.currentCategory||f._child&&f._child.some(h=>h.id===i.currentCategory)}]),onClick:h=>l.$emit("change-category",f.id)},t.toDisplayString(f.title),11,Ct),f._child&&f._child.length?(t.openBlock(),t.createElementBlock("div",St,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(f._child,h=>(t.openBlock(),t.createElementBlock("div",{key:h.id,class:t.normalizeClass(["upd-category__child-title",{"upd-category__child-title--active":h.id===i.currentCategory}]),onClick:t.withModifiers(V=>l.$emit("change-category",h.id),["stop"])},t.toDisplayString(h.title),11,kt))),128))])):t.createCommentVNode("",!0)]))),128))]),t.createElementVNode("div",Rt,[p[2]||(p[2]=t.createElementVNode("div",{class:"upd-filter__text"},null,-1)),t.createElementVNode("div",xt,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":p[1]||(p[1]=f=>s.value=f),type:"text",placeholder:"样式ID或关键词",onKeyup:t.withKeys(_,["enter"])},null,544),[[t.vModelText,s.value]])])])]),t.createElementVNode("div",Dt,[i.loading?(t.openBlock(),t.createElementBlock("div",Tt," 加载中... ")):(t.openBlock(),t.createElementBlock("div",$t,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.materials,f=>(t.openBlock(),t.createElementBlock("div",{key:f.id,class:"upd-material-list__item",onClick:h=>l.$emit("select",f)},[t.createElementVNode("div",{class:"upd-material-list__preview",innerHTML:f.html},null,8,Nt),t.createElementVNode("div",Pt,[t.createElementVNode("span",Ot,t.toDisplayString(f.title),1),t.createElementVNode("span",Lt,"ID: "+t.toDisplayString(f.id),1)])],8,Vt))),128)),i.loadingMore?(t.openBlock(),t.createElementBlock("div",jt," 加载更多... ")):!i.hasMore&&i.materials.length>0?(t.openBlock(),t.createElementBlock("div",Bt," 没有更多数据了 ")):t.createCommentVNode("",!0)]))])])])]))}}),me=(i,n)=>{const o=i.__vccOpts||i;for(const[r,s]of n)o[r]=s;return o},It=me(At,[["__scopeId","data-v-797b48ca"]]),Mt=["width","height","stroke"],Ut=me(t.defineComponent({__name:"IconClose",props:{size:{default:24},strokeColor:{default:"currentColor"}},setup(i){return(n,o)=>(t.openBlock(),t.createElementBlock("svg",{width:i.size,height:i.size,viewBox:"0 0 24 24",fill:"none",stroke:i.strokeColor,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon"},[...o[0]||(o[0]=[t.createElementVNode("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),t.createElementVNode("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)])],8,Mt))}}),[["__scopeId","data-v-218750c8"]]),zt={key:0,class:"upd-section-tools__panel"},Ft={class:"upd-section-tools__body"},Ht={class:"upd-section-tools__actions"},Wt={class:"upd-section-tools__line"},Yt={class:"upd-section-tools__field"},Kt={class:"upd-section-tools__line"},qt={class:"upd-section-tools__field"},Jt={class:"upd-section-tools__panel"},Gt={class:"upd-section-tools__head"},Xt={class:"upd-section-tools__desc"},Zt={class:"upd-section-tools__body"},Qt={class:"upd-section-tools__actions"},eo={class:"upd-section-tools__line"},to={class:"upd-section-tools__field"},oo={class:"upd-section-tools__line"},no={class:"upd-section-tools__field"},ro={class:"upd-section-tools__line"},io={class:"upd-section-tools__field"},ao=me(t.defineComponent({__name:"SectionTools",props:{sectionData:{},imageData:{},position:{}},emits:["action","image-action","close"],setup(i){return(n,o)=>(t.openBlock(),t.createElementBlock("div",{class:"upd-section-tools",style:t.normalizeStyle({left:i.position.left+"px",top:i.position.top+"px"})},[t.createElementVNode("div",{class:"upd-section-tools__close",onClick:o[0]||(o[0]=r=>n.$emit("close"))},[t.createVNode(Ut,{size:16,"stroke-color":"#fff"})]),i.imageData.show?(t.openBlock(),t.createElementBlock("div",zt,[o[21]||(o[21]=t.createElementVNode("div",{class:"upd-section-tools__head"},[t.createElementVNode("span",{class:"upd-section-tools__title"},"图片")],-1)),t.createElementVNode("div",Ft,[t.createElementVNode("div",Ht,[t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[1]||(o[1]=r=>n.$emit("image-action","change"))}," 换图 ")]),t.createElementVNode("div",Wt,[o[19]||(o[19]=t.createElementVNode("div",{class:"upd-section-tools__label"},"宽度%",-1)),t.createElementVNode("div",Yt,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>i.imageData.width=r),type:"range",min:"0",max:"100",class:"upd-slider"},null,512),[[t.vModelText,i.imageData.width,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>i.imageData.width=r),type:"number",min:"0",max:"100",class:"upd-input-number"},null,512),[[t.vModelText,i.imageData.width,void 0,{number:!0}]])])]),t.createElementVNode("div",Kt,[o[20]||(o[20]=t.createElementVNode("div",{class:"upd-section-tools__label"},"透明度",-1)),t.createElementVNode("div",qt,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[4]||(o[4]=r=>i.imageData.opacity=r),type:"range",min:"0",max:"1",step:"0.01",class:"upd-slider"},null,512),[[t.vModelText,i.imageData.opacity,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[5]||(o[5]=r=>i.imageData.opacity=r),type:"number",min:"0",max:"1",step:"0.01",class:"upd-input-number"},null,512),[[t.vModelText,i.imageData.opacity,void 0,{number:!0}]])])])])])):t.createCommentVNode("",!0),t.createElementVNode("div",Jt,[t.createElementVNode("div",Gt,[o[22]||(o[22]=t.createElementVNode("span",{class:"upd-section-tools__title"},"内容块",-1)),t.createElementVNode("span",Xt," 样式ID "+t.toDisplayString(i.sectionData.id||"-"),1)]),t.createElementVNode("div",Zt,[t.createElementVNode("div",Qt,[t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[6]||(o[6]=r=>n.$emit("action","clearFormat"))}," 清除样式 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[7]||(o[7]=r=>n.$emit("action","newSectionBefore"))}," 前空行 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[8]||(o[8]=r=>n.$emit("action","newSectionAfter"))}," 后空行 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[9]||(o[9]=r=>n.$emit("action","select"))}," 选中 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[10]||(o[10]=r=>n.$emit("action","delete"))}," 删除 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[11]||(o[11]=r=>n.$emit("action","moveUp"))}," 上移 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[12]||(o[12]=r=>n.$emit("action","moveDown"))}," 下移 ")]),t.createElementVNode("div",eo,[o[23]||(o[23]=t.createElementVNode("div",{class:"upd-section-tools__label"},"宽度%",-1)),t.createElementVNode("div",to,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[13]||(o[13]=r=>i.sectionData.width=r),type:"range",min:"0",max:"100",class:"upd-slider"},null,512),[[t.vModelText,i.sectionData.width,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[14]||(o[14]=r=>i.sectionData.width=r),type:"number",min:"0",max:"100",class:"upd-input-number"},null,512),[[t.vModelText,i.sectionData.width,void 0,{number:!0}]])])]),t.createElementVNode("div",oo,[o[24]||(o[24]=t.createElementVNode("div",{class:"upd-section-tools__label"},"旋转角度",-1)),t.createElementVNode("div",no,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[15]||(o[15]=r=>i.sectionData.rotate=r),type:"range",min:"-180",max:"180",class:"upd-slider"},null,512),[[t.vModelText,i.sectionData.rotate,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[16]||(o[16]=r=>i.sectionData.rotate=r),type:"number",min:"-180",max:"180",class:"upd-input-number"},null,512),[[t.vModelText,i.sectionData.rotate,void 0,{number:!0}]])])]),t.createElementVNode("div",ro,[o[25]||(o[25]=t.createElementVNode("div",{class:"upd-section-tools__label"},"透明度",-1)),t.createElementVNode("div",io,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[17]||(o[17]=r=>i.sectionData.opacity=r),type:"range",min:"0",max:"1",step:"0.01",class:"upd-slider"},null,512),[[t.vModelText,i.sectionData.opacity,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[18]||(o[18]=r=>i.sectionData.opacity=r),type:"number",min:"0",max:"1",step:"0.01",class:"upd-input-number"},null,512),[[t.vModelText,i.sectionData.opacity,void 0,{number:!0}]])])])])])],4))}}),[["__scopeId","data-v-f465a212"]]),so=["width","height","stroke"],lo=me(t.defineComponent({__name:"IconCheck",props:{size:{default:24},strokeColor:{default:"currentColor"}},setup(i){return(n,o)=>(t.openBlock(),t.createElementBlock("svg",{width:i.size,height:i.size,viewBox:"0 0 24 24",fill:"none",stroke:i.strokeColor,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon"},[...o[0]||(o[0]=[t.createElementVNode("polyline",{points:"20 6 9 17 4 12"},null,-1)])],8,so))}}),[["__scopeId","data-v-0ae058a4"]]),co={class:"ueditor-plus-designer"},uo={class:"ueditor-plus-designer__body"},fo={key:0,class:"ueditor-plus-designer__material"},mo={class:"ueditor-plus-designer__editor"},po={class:"upd-editor-instance"},ho=["id"],go={key:0,class:"upd-toolbar"},yo=t.defineComponent({__name:"Designer",props:{config:{default:()=>({})},isIframe:{type:Boolean,default:!1}},emits:["ready","change","confirm"],setup(i,{expose:n,emit:o}){const r=i,s=o,u=t.ref(null),_=t.ref(`upd_${Date.now()}`),d=t.ref(!0),l=t.ref(!1),p=t.ref({left:0,top:0}),{categories:f,materials:h,total:V,loading:M,loadingMore:Y,currentCategory:K,hasMore:de,changeCategory:F,search:T,loadMore:B}=pt(r.config),{currentSection:S,sectionData:ne,imageData:A,prepareSectionStyle:ue,prepareImageStyle:Te,clearSelection:pe}=ht(),{clearSectionFormat:$e,insertSection:he,selectSection:ge,deleteSection:H,moveSectionUp:q,moveSectionDown:X}=gt();t.onMounted(async()=>{const g=document.getElementById(_.value);if(g){u.value=new mt({...r.config,container:g});try{await u.value.init(),u.value.on("ready",()=>{s("ready"),re()}),u.value.on("change",b=>{s("change",b)}),u.value.on("section-click",Ee),window.addEventListener("resize",re)}catch(b){console.error("Failed to initialize designer:",b)}}}),t.onUnmounted(()=>{var g;window.removeEventListener("resize",re),(g=u.value)==null||g.destroy()});const ye=g=>{u.value&&u.value.insertSection(g.html,{id:g.id})},ve=g=>{T(g)},Ee=({section:g,element:b,image:j})=>{S.value=g,ue(g),j?Te(g,j):A.value.show=!1,l.value=!0,fe(g)},fe=g=>{if(!u.value)return;const b=u.value.getEditor();if(!b)return;const j=document.querySelector(`#${_.value}`);if(!j)return;const Z=j.querySelector(".edui-editor-iframeholder > iframe");if(!Z)return;const Q=b.document,C=_e(g,Z,Q),P=320,R=350;let J=C.left+(C.width-P)/2-C.relativeLeft;J=Math.max(0,Math.min(J,C.containerWidth-P));let W;if(C.spaceTop>C.spaceBottom&&C.spaceTop>R)W=C.top-R-C.relativeTop,W=Math.max(0,W);else{W=C.top+C.height-C.relativeTop;const Se=C.top+C.height+C.spaceBottom-C.relativeTop-R;W=Math.min(W,Se)}p.value={left:J,top:W}},_e=(g,b,j)=>{const Z=document.querySelector(".ueditor-plus-designer");if(!Z)return{left:0,top:0,width:0,height:0,containerWidth:0,containerHeight:0,spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,relativeLeft:0,relativeTop:0};const Q=b.getBoundingClientRect(),C=g.getBoundingClientRect(),P=Z.getBoundingClientRect(),R={left:Q.left+C.left-j.documentElement.scrollLeft,top:Q.top+C.top-j.documentElement.scrollTop,width:C.width,height:C.height,containerWidth:P.width,containerHeight:P.height,spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,relativeLeft:P.left,relativeTop:P.top};return R.spaceTop=R.top-P.top,R.spaceLeft=R.left-P.left,R.spaceBottom=P.top+P.height-(R.top+R.height),R.spaceRight=P.left+P.width-(R.left+R.width),R},re=()=>{l.value&&S.value&&fe(S.value)},U=()=>{S.value&&S.value.classList.remove(D.SectionActiveClass),l.value=!1,pe()},be=g=>{if(!u.value||!S.value)return;const b=u.value.getEditor();if(b)switch(g){case"clearFormat":$e(b,S.value),U();break;case"newSectionBefore":he(b,S.value,"before"),U();break;case"newSectionAfter":he(b,S.value,"after"),U();break;case"select":ge(b,S.value),U();break;case"delete":H(b,S.value),U();break;case"moveUp":q(b,S.value),U();break;case"moveDown":X(b,S.value),U();break}},Ve=g=>{console.log("Image action:",g)},Ne=()=>{if(u.value){const g=u.value.getContent();s("confirm",g)}};return n({getContent:()=>{var g;return((g=u.value)==null?void 0:g.getContent())||""},setContent:g=>{var b;(b=u.value)==null||b.setContent(g)}}),(g,b)=>(t.openBlock(),t.createElementBlock("div",co,[t.createElementVNode("div",uo,[d.value?(t.openBlock(),t.createElementBlock("div",fo,[t.createVNode(It,{categories:t.unref(f),materials:t.unref(h),total:t.unref(V),"current-category":t.unref(K),loading:t.unref(M),"loading-more":t.unref(Y),"has-more":t.unref(de),onSelect:ye,onChangeCategory:t.unref(F),onSearch:ve,onLoadMore:t.unref(B)},null,8,["categories","materials","total","current-category","loading","loading-more","has-more","onChangeCategory","onLoadMore"])])):t.createCommentVNode("",!0),t.createElementVNode("div",mo,[t.createElementVNode("div",po,[t.createElementVNode("div",{id:_.value,style:{height:"100%"}},null,8,ho)]),i.isIframe?(t.openBlock(),t.createElementBlock("div",go,[t.createElementVNode("a",{class:"upd-toolbar__item",href:"javascript:;",onClick:Ne},[t.createVNode(lo,{size:16}),b[0]||(b[0]=t.createTextVNode(" 完成 ",-1))])])):t.createCommentVNode("",!0)])]),l.value?(t.openBlock(),t.createBlock(ao,{key:0,"section-data":t.unref(ne),"image-data":t.unref(A),position:p.value,onAction:be,onImageAction:Ve,onClose:U},null,8,["section-data","image-data","position"])):t.createCommentVNode("",!0)]))}}),vo=te.applyVueInReact(yo),Fe=$.forwardRef((i,n)=>{const o=$.useRef(null);return $.useImperativeHandle(n,()=>({getContent:()=>{const r=o.current;return r?r.__veauryVueRef__&&typeof r.__veauryVueRef__.getContent=="function"?r.__veauryVueRef__.getContent():typeof r.getContent=="function"?r.getContent():r.$refs&&r.$refs.component&&typeof r.$refs.component.getContent=="function"?r.$refs.component.getContent():r.exposed&&typeof r.exposed.getContent=="function"?r.exposed.getContent():r.$exposed&&typeof r.$exposed.getContent=="function"?r.$exposed.getContent():(console.error("Cannot find getContent method in:",r),console.error("Available properties:",Object.keys(r)),""):""},setContent:r=>{const s=o.current;if(s){if(s.__veauryVueRef__&&typeof s.__veauryVueRef__.setContent=="function"){s.__veauryVueRef__.setContent(r);return}typeof s.setContent=="function"?s.setContent(r):s.$refs&&s.$refs.component&&typeof s.$refs.component.setContent=="function"?s.$refs.component.setContent(r):s.exposed&&typeof s.exposed.setContent=="function"?s.exposed.setContent(r):s.$exposed&&typeof s.$exposed.setContent=="function"?s.$exposed.setContent(r):(console.error("Cannot find setContent method in:",s),console.error("Available properties:",Object.keys(s)))}}})),rt.jsx(vo,{ref:o,...i})});N.UEditorPlusDesigner=Fe,N.default=Fe,Object.defineProperties(N,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
