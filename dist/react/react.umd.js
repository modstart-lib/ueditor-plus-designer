(function(V,$){typeof exports=="object"&&typeof module<"u"?$(exports,require("react"),require("veaury"),require("vue")):typeof define=="function"&&define.amd?define(["exports","react","veaury","vue"],$):(V=typeof globalThis<"u"?globalThis:V||self,$(V.UEditorPlusDesignerReact={},V.React,V.veaury,V.Vue))})(this,function(V,$,oe,t){"use strict";var zo=Object.defineProperty;var Fo=(V,$,oe)=>$ in V?zo(V,$,{enumerable:!0,configurable:!0,writable:!0,value:oe}):V[$]=oe;var F=(V,$,oe)=>Fo(V,typeof $!="symbol"?$+"":$,oe);var xe={exports:{}},ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie;function rt(){if(Ie)return ce;Ie=1;var i=$,r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function w(d,l,p){var f,v={},N=null,I=null;p!==void 0&&(N=""+p),l.key!==void 0&&(N=""+l.key),l.ref!==void 0&&(I=l.ref);for(f in l)n.call(l,f)&&!u.hasOwnProperty(f)&&(v[f]=l[f]);if(d&&d.defaultProps)for(f in l=d.defaultProps,l)v[f]===void 0&&(v[f]=l[f]);return{$$typeof:r,type:d,key:N,ref:I,props:v,_owner:s.current}}return ce.Fragment=o,ce.jsx=w,ce.jsxs=w,ce}var de={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ze;function it(){return ze||(ze=1,process.env.NODE_ENV!=="production"&&function(){var i=$,r=Symbol.for("react.element"),o=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),d=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),v=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),I=Symbol.for("react.offscreen"),W=Symbol.iterator,Y="@@iterator";function fe(e){if(e===null||typeof e!="object")return null;var a=W&&e[W]||e[Y];return typeof a=="function"?a:null}var U=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function D(e){{for(var a=arguments.length,c=new Array(a>1?a-1:0),m=1;m<a;m++)c[m-1]=arguments[m];j("error",e,c)}}function j(e,a,c){{var m=U.ReactDebugCurrentFrame,E=m.getStackAddendum();E!==""&&(a+="%s",c=c.concat([E]));var b=c.map(function(y){return String(y)});b.unshift("Warning: "+a),Function.prototype.apply.call(console[e],console,b)}}var C=!1,re=!1,A=!1,me=!1,$e=!1,ye;ye=Symbol.for("react.module.reference");function Ve(e){return!!(typeof e=="string"||typeof e=="function"||e===n||e===u||$e||e===s||e===p||e===f||me||e===I||C||re||A||typeof e=="object"&&e!==null&&(e.$$typeof===N||e.$$typeof===v||e.$$typeof===w||e.$$typeof===d||e.$$typeof===l||e.$$typeof===ye||e.getModuleId!==void 0))}function ve(e,a,c){var m=e.displayName;if(m)return m;var E=a.displayName||a.name||"";return E!==""?c+"("+E+")":c}function Ee(e){return e.displayName||"Context"}function H(e){if(e==null)return null;if(typeof e.tag=="number"&&D("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case n:return"Fragment";case o:return"Portal";case u:return"Profiler";case s:return"StrictMode";case p:return"Suspense";case f:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case d:var a=e;return Ee(a)+".Consumer";case w:var c=e;return Ee(c._context)+".Provider";case l:return ve(e,e.render,"ForwardRef");case v:var m=e.displayName||null;return m!==null?m:H(e.type)||"Memo";case N:{var E=e,b=E._payload,y=E._init;try{return H(y(b))}catch{return null}}}return null}var q=Object.assign,Z=0,_e,be,we,pe,Ce,ie,z;function Se(){}Se.__reactDisabledLog=!0;function Ne(){{if(Z===0){_e=console.log,be=console.info,we=console.warn,pe=console.error,Ce=console.group,ie=console.groupCollapsed,z=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Se,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}Z++}}function Pe(){{if(Z--,Z===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:q({},e,{value:_e}),info:q({},e,{value:be}),warn:q({},e,{value:we}),error:q({},e,{value:pe}),group:q({},e,{value:Ce}),groupCollapsed:q({},e,{value:ie}),groupEnd:q({},e,{value:z})})}Z<0&&D("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ke=U.ReactCurrentDispatcher,Re;function h(e,a,c){{if(Re===void 0)try{throw Error()}catch(E){var m=E.stack.trim().match(/\n( *(at )?)/);Re=m&&m[1]||""}return`
`+Re+e}}var _=!1,B;{var J=typeof WeakMap=="function"?WeakMap:Map;B=new J}function Q(e,a){if(!e||_)return"";{var c=B.get(e);if(c!==void 0)return c}var m;_=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var b;b=ke.current,ke.current=null,Ne();try{if(a){var y=function(){throw Error()};if(Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(L){m=L}Reflect.construct(e,[],y)}else{try{y.call()}catch(L){m=L}e.call(y.prototype)}}else{try{throw Error()}catch(L){m=L}e()}}catch(L){if(L&&m&&typeof L.stack=="string"){for(var g=L.stack.split(`
`),P=m.stack.split(`
`),S=g.length-1,R=P.length-1;S>=1&&R>=0&&g[S]!==P[R];)R--;for(;S>=1&&R>=0;S--,R--)if(g[S]!==P[R]){if(S!==1||R!==1)do if(S--,R--,R<0||g[S]!==P[R]){var M=`
`+g[S].replace(" at new "," at ");return e.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",e.displayName)),typeof e=="function"&&B.set(e,M),M}while(S>=1&&R>=0);break}}}finally{_=!1,ke.current=b,Pe(),Error.prepareStackTrace=E}var le=e?e.displayName||e.name:"",te=le?h(le):"";return typeof e=="function"&&B.set(e,te),te}function T(e,a,c){return Q(e,!1)}function O(e){var a=e.prototype;return!!(a&&a.isReactComponent)}function k(e,a,c){if(e==null)return"";if(typeof e=="function")return Q(e,O(e));if(typeof e=="string")return h(e);switch(e){case p:return h("Suspense");case f:return h("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case l:return T(e.render);case v:return k(e.type,a,c);case N:{var m=e,E=m._payload,b=m._init;try{return k(b(E),a,c)}catch{}}}return""}var ee=Object.prototype.hasOwnProperty,ae={},he=U.ReactDebugCurrentFrame;function G(e){if(e){var a=e._owner,c=k(e.type,e._source,a?a.type:null);he.setExtraStackFrame(c)}else he.setExtraStackFrame(null)}function K(e,a,c,m,E){{var b=Function.call.bind(ee);for(var y in e)if(b(e,y)){var g=void 0;try{if(typeof e[y]!="function"){var P=Error((m||"React class")+": "+c+" type `"+y+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[y]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw P.name="Invariant Violation",P}g=e[y](a,y,m,c,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(S){g=S}g&&!(g instanceof Error)&&(G(E),D("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",m||"React class",c,y,typeof g),G(null)),g instanceof Error&&!(g.message in ae)&&(ae[g.message]=!0,G(E),D("Failed %s type: %s",c,g.message),G(null))}}}var Oe=Array.isArray;function Le(e){return Oe(e)}function bo(e){{var a=typeof Symbol=="function"&&Symbol.toStringTag,c=a&&e[Symbol.toStringTag]||e.constructor.name||"Object";return c}}function wo(e){try{return Ye(e),!1}catch{return!0}}function Ye(e){return""+e}function qe(e){if(wo(e))return D("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",bo(e)),Ye(e)}var Ke=U.ReactCurrentOwner,Co={key:!0,ref:!0,__self:!0,__source:!0},Je,Ge;function So(e){if(ee.call(e,"ref")){var a=Object.getOwnPropertyDescriptor(e,"ref").get;if(a&&a.isReactWarning)return!1}return e.ref!==void 0}function ko(e){if(ee.call(e,"key")){var a=Object.getOwnPropertyDescriptor(e,"key").get;if(a&&a.isReactWarning)return!1}return e.key!==void 0}function Ro(e,a){typeof e.ref=="string"&&Ke.current}function xo(e,a){{var c=function(){Je||(Je=!0,D("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",a))};c.isReactWarning=!0,Object.defineProperty(e,"key",{get:c,configurable:!0})}}function Do(e,a){{var c=function(){Ge||(Ge=!0,D("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",a))};c.isReactWarning=!0,Object.defineProperty(e,"ref",{get:c,configurable:!0})}}var To=function(e,a,c,m,E,b,y){var g={$$typeof:r,type:e,key:a,ref:c,props:y,_owner:b};return g._store={},Object.defineProperty(g._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(g,"_self",{configurable:!1,enumerable:!1,writable:!1,value:m}),Object.defineProperty(g,"_source",{configurable:!1,enumerable:!1,writable:!1,value:E}),Object.freeze&&(Object.freeze(g.props),Object.freeze(g)),g};function $o(e,a,c,m,E){{var b,y={},g=null,P=null;c!==void 0&&(qe(c),g=""+c),ko(a)&&(qe(a.key),g=""+a.key),So(a)&&(P=a.ref,Ro(a,E));for(b in a)ee.call(a,b)&&!Co.hasOwnProperty(b)&&(y[b]=a[b]);if(e&&e.defaultProps){var S=e.defaultProps;for(b in S)y[b]===void 0&&(y[b]=S[b])}if(g||P){var R=typeof e=="function"?e.displayName||e.name||"Unknown":e;g&&xo(y,R),P&&Do(y,R)}return To(e,g,P,E,m,Ke.current,y)}}var Be=U.ReactCurrentOwner,Xe=U.ReactDebugCurrentFrame;function se(e){if(e){var a=e._owner,c=k(e.type,e._source,a?a.type:null);Xe.setExtraStackFrame(c)}else Xe.setExtraStackFrame(null)}var je;je=!1;function Ae(e){return typeof e=="object"&&e!==null&&e.$$typeof===r}function Ze(){{if(Be.current){var e=H(Be.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Vo(e){return""}var Qe={};function No(e){{var a=Ze();if(!a){var c=typeof e=="string"?e:e.displayName||e.name;c&&(a=`

Check the top-level render call using <`+c+">.")}return a}}function et(e,a){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var c=No(a);if(Qe[c])return;Qe[c]=!0;var m="";e&&e._owner&&e._owner!==Be.current&&(m=" It was passed a child from "+H(e._owner.type)+"."),se(e),D('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',c,m),se(null)}}function tt(e,a){{if(typeof e!="object")return;if(Le(e))for(var c=0;c<e.length;c++){var m=e[c];Ae(m)&&et(m,a)}else if(Ae(e))e._store&&(e._store.validated=!0);else if(e){var E=fe(e);if(typeof E=="function"&&E!==e.entries)for(var b=E.call(e),y;!(y=b.next()).done;)Ae(y.value)&&et(y.value,a)}}}function Po(e){{var a=e.type;if(a==null||typeof a=="string")return;var c;if(typeof a=="function")c=a.propTypes;else if(typeof a=="object"&&(a.$$typeof===l||a.$$typeof===v))c=a.propTypes;else return;if(c){var m=H(a);K(c,e.props,"prop",m,e)}else if(a.PropTypes!==void 0&&!je){je=!0;var E=H(a);D("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",E||"Unknown")}typeof a.getDefaultProps=="function"&&!a.getDefaultProps.isReactClassApproved&&D("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Oo(e){{for(var a=Object.keys(e.props),c=0;c<a.length;c++){var m=a[c];if(m!=="children"&&m!=="key"){se(e),D("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",m),se(null);break}}e.ref!==null&&(se(e),D("Invalid attribute `ref` supplied to `React.Fragment`."),se(null))}}var ot={};function nt(e,a,c,m,E,b){{var y=Ve(e);if(!y){var g="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(g+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var P=Vo();P?g+=P:g+=Ze();var S;e===null?S="null":Le(e)?S="array":e!==void 0&&e.$$typeof===r?(S="<"+(H(e.type)||"Unknown")+" />",g=" Did you accidentally export a JSX literal instead of a component?"):S=typeof e,D("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",S,g)}var R=$o(e,a,c,E,b);if(R==null)return R;if(y){var M=a.children;if(M!==void 0)if(m)if(Le(M)){for(var le=0;le<M.length;le++)tt(M[le],e);Object.freeze&&Object.freeze(M)}else D("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else tt(M,e)}if(ee.call(a,"key")){var te=H(e),L=Object.keys(a).filter(function(Io){return Io!=="key"}),Me=L.length>0?"{key: someKey, "+L.join(": ..., ")+": ...}":"{key: someKey}";if(!ot[te+Me]){var Mo=L.length>0?"{"+L.join(": ..., ")+": ...}":"{}";D(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Me,te,Mo,te),ot[te+Me]=!0}}return e===n?Oo(R):Po(R),R}}function Lo(e,a,c){return nt(e,a,c,!0)}function Bo(e,a,c){return nt(e,a,c,!1)}var jo=Bo,Ao=Lo;de.Fragment=n,de.jsx=jo,de.jsxs=Ao}()),de}process.env.NODE_ENV==="production"?xe.exports=rt():xe.exports=it();var at=xe.exports;const Fe="https://paiban.tecmz.com/api/live_rich_editor";async function st(){var i;try{const r=await fetch(`${Fe}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.json();if(o.code!==0||!((i=o.data)!=null&&i.tree))throw new Error(o.msg||"Failed to fetch categories");return Ue(o.data.tree)}catch(r){return console.error("Failed to fetch categories:",r),[]}}function Ue(i){return i.map(r=>({id:r.id,title:r.title,pid:r.pid,sort:r.sort||0,_child:r._child?Ue(r._child):void 0}))}async function lt(i){try{const r={paginate:{page:(i==null?void 0:i.page)||1,pageSize:(i==null?void 0:i.pageSize)||100,search:{}}};i!=null&&i.categoryId&&(r.paginate.search.categoryId=i.categoryId),i!=null&&i.keywords&&(r.paginate.search.keywords=i.keywords);const o=await fetch(`${Fe}/paginate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();if(n.code!==0||!n.data)throw new Error(n.msg||"Failed to fetch materials");return n.data}catch(r){return console.error("Failed to fetch materials:",r),{page:1,pageSize:(i==null?void 0:i.pageSize)||10,total:0,records:[]}}}function ct(i){return i.map(r=>({...r,id:r.id,title:r.title,html:r.html}))}async function dt(){try{return await st()}catch(i){return console.error("Default category loader error:",i),[]}}async function ut(i){try{const r=await lt(i);return{records:ct(r.records),total:r.total,page:r.page,pageSize:r.pageSize}}catch(r){return console.error("Default style loader error:",r),{records:[],total:0,page:1,pageSize:(i==null?void 0:i.pageSize)||100}}}const x={SectionClass:"pb-section",SectionActiveClass:"pb-section-active",SectionHoverClass:"pb-section-hover",DefaultCategoryLoader:dt,DefaultStyleLoader:ut},ft=[["source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","insertimage","emotion","scrawl","insertvideo","attachment","map","insertframe","insertcode","pagebreak","template","background","|","horizontal","date","time","spechars","wordimage","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","print","preview","searchreplace","shortcutmenu"]];let ue=!1,He=!1;const De=[];function mt(i="/ueditor-plus"){return new Promise((r,o)=>{if(He&&window.UE){r(window.UE);return}if(ue){De.push(()=>r(window.UE));return}ue=!0;const n=i.endsWith("/")?i:`${i}/`;window.UEDITOR_HOME_URL=n;const s=document.createElement("script");s.src=`${n}ueditor.config.js`,s.onload=()=>{const u=document.createElement("script");u.src=`${n}ueditor.all.js`,u.onload=()=>{He=!0,ue=!1,De.forEach(w=>w()),De.length=0,r(window.UE)},u.onerror=()=>{ue=!1,o(new Error("Failed to load UEditor main script"))},document.head.appendChild(u)},s.onerror=()=>{ue=!1,o(new Error("Failed to load UEditor config script"))},document.head.appendChild(s)})}const pt=`
/* Section基础样式 */
section.pb-section {
  position: relative;
  margin: 10px auto;
  padding: 0;
  transition: all 0.2s;
  cursor: pointer;
  min-height: 20px;
}

/* Section激活状态 */
section.pb-section.pb-section-active {
  outline: 2px dashed rgba(255, 0, 0, 0.4);
  outline-offset: 2px;
}

/* 子Section悬停状态 */
section.pb-section .pb-section-hover {
  outline: 1px dashed rgba(0, 0, 255, 0.3);
  outline-offset: 1px;
}

/* 子Section激活状态 */
section.pb-section .pb-section-active {
  outline: 1px dashed rgba(0, 0, 255, 0.5);
  outline-offset: 1px;
}

/* 子Section样式 */
section:not(.pb-section) {
  position: relative;
  transition: all 0.2s;
}

section:not(.pb-section).pb-section-hover {
  outline: 1px dashed rgba(0, 0, 255, 0.3);
  outline-offset: 1px;
}

/* 图片样式增强 */
section.pb-section img {
  max-width: 100%;
  height: auto;
  display: block;
  transition: all 0.2s;
}

section.pb-section img:hover {
  opacity: 0.9;
  cursor: pointer;
}

/* 表格样式优化 */
section.pb-section table {
  border-collapse: collapse;
  width: 100%;
  margin: 10px 0;
}

section.pb-section table td,
section.pb-section table th {
  border: 1px solid #ddd;
  padding: 8px;
}

section.pb-section table th {
  background: #f5f5f5;
  font-weight: bold;
}

/* 防止内容溢出 */
section.pb-section {
  overflow: hidden;
  word-wrap: break-word;
}

/* 空Section提示 */
section.pb-section:empty::before {
  content: '空内容块 - 点击编辑';
  color: #999;
  font-size: 14px;
}
`;class ht{constructor(r){F(this,"config");F(this,"container",null);F(this,"editor",null);F(this,"editorId");F(this,"eventHandlers",new Map);F(this,"resizeHandler",null);F(this,"editorElement",null);const o=r.ueditorConfig||{};o.iframeCssStylesAddition||(o.iframeCssStylesAddition=[]),o.iframeCssStylesAddition=[pt,...o.iframeCssStylesAddition],o.toolbars||(o.toolbars=ft),o.toolbars[o.toolbars.length-1].push("liveeditor");let n=r.categoryLoader||x.DefaultCategoryLoader,s=r.styleLoader||x.DefaultStyleLoader;this.config={container:r.container||"#editor",ueditorPath:r.ueditorPath||"/ueditor-plus",ueditorConfig:o,categoryLoader:n,styleLoader:s,onReady:r.onReady||(()=>{}),onChange:r.onChange||(()=>{})},this.editorId=`ueditorPlusDesigner_${Date.now()}`}async init(){if(typeof this.config.container=="string"?this.container=document.querySelector(this.config.container):this.container=this.config.container,!this.container)throw new Error("Container not found");await mt(this.config.ueditorPath);const r=window.UE;if(!r)throw new Error("UEditor failed to load");const o=document.createElement("div");o.id=this.editorId,this.container.appendChild(o),this.editorElement=o;const n={autoHeightEnabled:!1,initialFrameWidth:"100%",...this.config.ueditorConfig};this.editor=r.getEditor(this.editorId,n),this.editorEvent(),Math.random()>.5&&(new window.Image().src="https://open.modstart.com/license-logo.png?ueditor-plus-designer"),this.editor.ready(()=>{this.setupResizeListener(),this.doLayout(),this.config.onReady(),this.emit("ready")}),this.editor.addListener("contentChange",()=>{const s=this.getContent();this.config.onChange(s),this.emit("change",s)})}editorEvent(){this.editor.on("click",(r,o)=>{const n=o.target,s=n.closest(`.${x.SectionClass}`);if(!s||(this.editor.document.querySelectorAll(`.${x.SectionClass}`).forEach(p=>{p.classList.remove(x.SectionActiveClass)}),s.classList.add(x.SectionActiveClass),this.editor.selection.getText()))return;let d=null;const l=this.editor.selection.getRange().getClosedNode();l&&l.tagName&&l.tagName.toLowerCase()==="img"&&(d=l),this.emit("section-click",{section:s,element:n,image:d})}),this.editor.addListener("mouseover mouseout",(r,o)=>{const n=o.target;if(this.editor.document.querySelectorAll(`section:not(.${x.SectionClass})`).forEach(u=>{u.classList.remove(x.SectionHoverClass)}),!n.classList.contains(x.SectionClass)){const u=n.closest(`section:not(.${x.SectionClass})`);r==="mouseover"&&u&&u.classList.add(x.SectionHoverClass)}})}getContent(){var r;return((r=this.editor)==null?void 0:r.getContent())||""}setContent(r){var o;(o=this.editor)==null||o.setContent(r)}insertSection(r,o){if(!this.editor)return;const n=(o==null?void 0:o.id)||"",s=`<section class="${x.SectionClass} ${x.SectionActiveClass}" data-section-id="${n}">${r}</section>`;this.editor.execCommand("insertHtml",s)}doLayout(){if(!this.container||!this.editor||!this.editorElement)return;const r=this.container.clientHeight,o=this.editorElement.querySelector(".edui-editor-toolbarbox"),n=o?o.offsetHeight:0,s=r-n;this.editor.setHeight(Math.max(s,100))}setupResizeListener(){let r=null;this.resizeHandler=()=>{r!==null&&window.clearTimeout(r),r=window.setTimeout(()=>{this.doLayout()},150)},window.addEventListener("resize",this.resizeHandler)}destroy(){var r;this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),(r=this.editor)==null||r.destroy(),this.editor=null,this.eventHandlers.clear()}on(r,o){this.eventHandlers.has(r)||this.eventHandlers.set(r,[]),this.eventHandlers.get(r).push(o)}off(r,o){if(!o){this.eventHandlers.delete(r);return}const n=this.eventHandlers.get(r);if(n){const s=n.indexOf(o);s>-1&&n.splice(s,1)}}emit(r,...o){const n=this.eventHandlers.get(r);n&&n.forEach(s=>s(...o))}getEditor(){return this.editor}}function gt(i){const r=t.ref([]),o=t.ref([]),n=t.ref(0),s=t.ref(!1),u=t.ref(!1),w=t.ref(!1),d=t.ref(0),l=t.ref(""),p=t.ref(1),f=t.ref(100),v=t.ref(!0),N=()=>i.categoryLoader?i.categoryLoader:x.DefaultCategoryLoader,I=()=>i.styleLoader?i.styleLoader:x.DefaultStyleLoader,W=async()=>{const j=N();if(j){w.value=!0;try{r.value=await j()}catch(C){console.error("Failed to load categories:",C),r.value=[]}finally{w.value=!1}}},Y=async(j,C=!1)=>{const re=I();if(re){C?u.value=!0:s.value=!0;try{const A=await re({categoryId:d.value,keywords:l.value,page:p.value,pageSize:f.value,...j});C?o.value=[...o.value,...A.records]:o.value=A.records,n.value=A.total,f.value=A.pageSize;const me=Math.ceil(A.total/f.value);v.value=p.value<me}catch(A){console.error("Failed to load materials:",A),C||(o.value=[],n.value=0,v.value=!1)}finally{C?u.value=!1:s.value=!1}}},fe=async()=>{u.value||!v.value||(p.value++,await Y(void 0,!0))},U=j=>{d.value=j,p.value=1,v.value=!0,Y()},D=j=>{l.value=j,p.value=1,v.value=!0,Y()};return t.onMounted(async()=>{await W(),await Y()}),{categories:r,materials:o,total:n,loading:s,loadingMore:u,loadingCategories:w,currentCategory:d,keywords:l,currentPage:p,hasMore:v,loadMaterials:Y,loadMore:fe,changeCategory:U,search:D}}const ne=class ne{constructor(){F(this,"element",null);F(this,"styles",{})}dom(r){return this.element=r,this.parse(),this}parse(){if(this.styles={},!this.element)return this;const r=this.element.getAttribute("style");if(r){const o=r.split(";");for(const n of o){if(!n.trim())continue;const[s,u]=n.split(":").map(w=>w.trim());s&&u&&(this.styles[s]=u)}}return this}remove(r){return r in this.styles&&delete this.styles[r],this}removeDomAttr(r){var o;return(o=this.element)==null||o.removeAttribute(r),this}getStyleKeys(r){const o=[];for(const n of ne.prefixes){const s=`${n}${r}`;if(s in this.styles){o.push(s);break}}return o.length?o:[r]}setStyleValues(r,o){const n=this.getStyleKeys(r);if(!n.length)this.styles[r]=o("");else for(const s of n){const u=this.styles[s]||"";this.styles[s]=o(u)}}merge(r,o){if(r==="rotatez"){const n=`rotatez(${o}deg)`;this.setStyleValues("transform",s=>/rotatez\(.*?\)/.test(s)?s.replace(/rotatez\(.*?\)/,n):s?`${s} ${n}`:n)}else{this.styles[r]=String(o);for(const n of ne.prefixes){const s=`${n}${r}`;s in this.styles&&(this.styles[s]=String(o))}}return this}get(r,o=null){if(!this.element)return o;switch(r){case"opacity":{let n=this.element.style.opacity;if(!n)for(const s of ne.prefixes){const u=`${s}${r}`;if(u in this.styles){n=this.styles[u];break}}return n?parseFloat(n):o}case"rotatez":{const n=this.element.style.transform||"";let s=0;if(n.toLowerCase().indexOf("rotatez(")>=0){const u=n.toLowerCase().replace(/rotatex\s*\(\s*[0-9\-]*\s*deg\s*\)/g,"").replace(/rotatey\s*\(\s*[0-9\-]*\s*deg\s*\)/g,"").match(/rotatez\s*\(\s*([0-9\-]+)\s*deg\s*\)/);u&&(s=parseInt(u[1]),s>180?s-=360:s<-180&&(s+=360))}return s}default:return this.styles[r]||o}}toDom(){if(!this.element)return this;const r=[];for(const o in this.styles)r.push(`${o}:${this.styles[o]}`);return r.length?this.element.setAttribute("style",r.join(";")):this.element.removeAttribute("style"),this}};F(ne,"prefixes",["-moz-","-o-","-webkit-","-ms-"]);let Te=ne;const X={fromDom(i){return new Te().dom(i)}};function yt(){const i=t.ref(null),r=t.ref(null),o=t.ref({id:"",width:100,rotate:0,opacity:1}),n=t.ref({show:!1,element:null,width:100,opacity:1}),s=d=>{i.value=d,o.value.id=d.getAttribute("data-section-id")||"";const l=X.fromDom(d),p=d.style.width||"100%";o.value.width=parseInt(p)||100,o.value.rotate=l.get("rotatez",0),o.value.opacity=l.get("opacity",1)},u=(d,l)=>{n.value.element=l,n.value.show=!0,i.value=d;const p=X.fromDom(l),f=l.style.width||"100%";n.value.width=parseInt(f)||100,n.value.opacity=p.get("opacity",1)},w=()=>{i.value=null,r.value=null,n.value.show=!1,n.value.element=null};return t.watch(()=>o.value.width,d=>{i.value&&X.fromDom(i.value).merge("margin","0 auto").merge("width",`${d}%`).toDom().remove("max-width").removeDomAttr("width")}),t.watch(()=>o.value.rotate,d=>{i.value&&X.fromDom(i.value).merge("rotatez",d).toDom()}),t.watch(()=>o.value.opacity,d=>{i.value&&X.fromDom(i.value).merge("opacity",d).toDom()}),t.watch(()=>n.value.width,d=>{n.value.element&&X.fromDom(n.value.element).remove("max-width").merge("width",`${d}%`).toDom().removeDomAttr("width")}),t.watch(()=>n.value.opacity,d=>{n.value.element&&X.fromDom(n.value.element).merge("opacity",d).toDom()}),{currentSection:i,currentElement:r,sectionData:o,imageData:n,prepareSectionStyle:s,prepareImageStyle:u,clearSelection:w}}function vt(){const i=(d,l)=>{d&&(d.undoManger.save(),l(),d.undoManger.save(),d.syncCommandState())};return{clearSectionFormat:(d,l)=>{!d||!l||i(d,()=>{d.selection.getRange().selectNode(l).select(),d.execCommand("removeformat"),l.className=`${x.SectionClass} ${x.SectionActiveClass}`})},insertSection:(d,l,p)=>{if(!d||!l)return;const f=document.createElement("section");f.className=x.SectionClass,f.setAttribute("data-section-id","");const v=document.createElement("p"),N=document.createElement("br");v.appendChild(N),f.appendChild(v),i(d,()=>{var I,W;p==="before"?(I=l.parentNode)==null||I.insertBefore(f,l):(W=l.parentNode)==null||W.insertBefore(f,l.nextSibling)}),d.selection.getRange().setStart(v,0).setCursor(!1,!0)},selectSection:(d,l)=>{!d||!l||i(d,()=>{d.selection.getRange().selectNode(l).select()})},deleteSection:(d,l)=>{!d||!l||i(d,()=>{l.remove()})},moveSectionUp:(d,l)=>{if(!d||!l)return;const p=l.previousElementSibling;p&&i(d,()=>{var f;(f=l.parentNode)==null||f.insertBefore(l,p)})},moveSectionDown:(d,l)=>{if(!d||!l)return;const p=l.nextElementSibling;p&&i(d,()=>{var f;(f=l.parentNode)==null||f.insertBefore(l,p.nextSibling)})}}}const Et={class:"upd-material-panel"},_t={class:"upd-material-body"},bt={class:"upd-material-item"},wt={class:"upd-material-item__head"},Ct={class:"upd-category"},St={class:"upd-category__item"},kt=["onClick"],Rt={key:0,class:"upd-category__children"},xt=["onClick"],Dt={class:"upd-filter"},Tt={class:"upd-filter__search"},$t={class:"upd-material-item__body"},Vt={key:0,class:"upd-loading"},Nt={key:1,class:"upd-material-list"},Pt=["onClick"],Ot=["innerHTML"],Lt={class:"upd-material-list__info"},Bt={class:"upd-material-list__title"},jt={class:"upd-material-list__id"},At={key:0,class:"upd-loading-more"},Mt={key:1,class:"upd-no-more"},It=t.defineComponent({__name:"MaterialPanel",props:{categories:{},materials:{},total:{},currentCategory:{},loading:{type:Boolean,default:!1},loadingMore:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0}},emits:["select","change-category","search","load-more"],setup(i,{emit:r}){const o=i,n=r,s=t.ref(""),u=t.ref(null),w=()=>{n("search",s.value)},d=()=>{if(!u.value||o.loading||o.loadingMore||!o.hasMore)return;const l=u.value,p=l.scrollTop,f=l.scrollHeight,v=l.clientHeight;p+v>=f-50&&n("load-more")};return t.onMounted(()=>{u.value=document.querySelector(".upd-material-item"),u.value&&u.value.addEventListener("scroll",d)}),t.onUnmounted(()=>{u.value&&u.value.removeEventListener("scroll",d)}),(l,p)=>(t.openBlock(),t.createElementBlock("div",Et,[t.createElementVNode("div",_t,[t.createElementVNode("div",bt,[t.createElementVNode("div",wt,[t.createElementVNode("div",Ct,[t.createElementVNode("div",St,[t.createElementVNode("div",{class:t.normalizeClass(["upd-category__title",{"upd-category__title--active":i.currentCategory===0}]),onClick:p[0]||(p[0]=f=>l.$emit("change-category",0))}," 全部 ",2)]),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.categories,f=>(t.openBlock(),t.createElementBlock("div",{key:f.id,class:"upd-category__item"},[t.createElementVNode("div",{class:t.normalizeClass(["upd-category__title",{"upd-category__title--active":f.id===i.currentCategory||f._child&&f._child.some(v=>v.id===i.currentCategory)}]),onClick:v=>l.$emit("change-category",f.id)},t.toDisplayString(f.title),11,kt),f._child&&f._child.length?(t.openBlock(),t.createElementBlock("div",Rt,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(f._child,v=>(t.openBlock(),t.createElementBlock("div",{key:v.id,class:t.normalizeClass(["upd-category__child-title",{"upd-category__child-title--active":v.id===i.currentCategory}]),onClick:t.withModifiers(N=>l.$emit("change-category",v.id),["stop"])},t.toDisplayString(v.title),11,xt))),128))])):t.createCommentVNode("",!0)]))),128))]),t.createElementVNode("div",Dt,[p[2]||(p[2]=t.createElementVNode("div",{class:"upd-filter__text"},null,-1)),t.createElementVNode("div",Tt,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":p[1]||(p[1]=f=>s.value=f),type:"text",placeholder:"样式ID或关键词",onKeyup:t.withKeys(w,["enter"])},null,544),[[t.vModelText,s.value]])])])]),t.createElementVNode("div",$t,[i.loading?(t.openBlock(),t.createElementBlock("div",Vt," 加载中... ")):(t.openBlock(),t.createElementBlock("div",Nt,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.materials,f=>(t.openBlock(),t.createElementBlock("div",{key:f.id,class:"upd-material-list__item",onClick:v=>l.$emit("select",f)},[t.createElementVNode("div",{class:"upd-material-list__preview",innerHTML:f.html},null,8,Ot),t.createElementVNode("div",Lt,[t.createElementVNode("span",Bt,t.toDisplayString(f.title),1),t.createElementVNode("span",jt,"ID: "+t.toDisplayString(f.id),1)])],8,Pt))),128)),i.loadingMore?(t.openBlock(),t.createElementBlock("div",At," 加载更多... ")):!i.hasMore&&i.materials.length>0?(t.openBlock(),t.createElementBlock("div",Mt," 没有更多数据了 ")):t.createCommentVNode("",!0)]))])])])]))}}),ge=(i,r)=>{const o=i.__vccOpts||i;for(const[n,s]of r)o[n]=s;return o},zt=ge(It,[["__scopeId","data-v-797b48ca"]]),Ft=["width","height","stroke"],Ut=ge(t.defineComponent({__name:"IconClose",props:{size:{default:24},strokeColor:{default:"currentColor"}},setup(i){return(r,o)=>(t.openBlock(),t.createElementBlock("svg",{width:i.size,height:i.size,viewBox:"0 0 24 24",fill:"none",stroke:i.strokeColor,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon"},[...o[0]||(o[0]=[t.createElementVNode("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),t.createElementVNode("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)])],8,Ft))}}),[["__scopeId","data-v-218750c8"]]),Ht={key:0,class:"upd-section-tools__panel"},Wt={class:"upd-section-tools__body"},Yt={class:"upd-section-tools__actions"},qt={class:"upd-section-tools__line"},Kt={class:"upd-section-tools__field"},Jt={class:"upd-section-tools__line"},Gt={class:"upd-section-tools__field"},Xt={class:"upd-section-tools__panel"},Zt={class:"upd-section-tools__head"},Qt={class:"upd-section-tools__desc"},eo={class:"upd-section-tools__body"},to={class:"upd-section-tools__actions"},oo={class:"upd-section-tools__line"},no={class:"upd-section-tools__field"},ro={class:"upd-section-tools__line"},io={class:"upd-section-tools__field"},ao={class:"upd-section-tools__line"},so={class:"upd-section-tools__field"},lo=ge(t.defineComponent({__name:"SectionTools",props:{sectionData:{},imageData:{},position:{}},emits:["action","image-action","close"],setup(i){return(r,o)=>(t.openBlock(),t.createElementBlock("div",{class:"upd-section-tools",style:t.normalizeStyle({left:i.position.left+"px",top:i.position.top+"px"})},[t.createElementVNode("div",{class:"upd-section-tools__close",onClick:o[0]||(o[0]=n=>r.$emit("close"))},[t.createVNode(Ut,{size:16,"stroke-color":"#fff"})]),i.imageData.show?(t.openBlock(),t.createElementBlock("div",Ht,[o[21]||(o[21]=t.createElementVNode("div",{class:"upd-section-tools__head"},[t.createElementVNode("span",{class:"upd-section-tools__title"},"图片")],-1)),t.createElementVNode("div",Wt,[t.createElementVNode("div",Yt,[t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[1]||(o[1]=n=>r.$emit("image-action","change"))}," 换图 ")]),t.createElementVNode("div",qt,[o[19]||(o[19]=t.createElementVNode("div",{class:"upd-section-tools__label"},"宽度%",-1)),t.createElementVNode("div",Kt,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[2]||(o[2]=n=>i.imageData.width=n),type:"range",min:"0",max:"100",class:"upd-slider"},null,512),[[t.vModelText,i.imageData.width,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[3]||(o[3]=n=>i.imageData.width=n),type:"number",min:"0",max:"100",class:"upd-input-number"},null,512),[[t.vModelText,i.imageData.width,void 0,{number:!0}]])])]),t.createElementVNode("div",Jt,[o[20]||(o[20]=t.createElementVNode("div",{class:"upd-section-tools__label"},"透明度",-1)),t.createElementVNode("div",Gt,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[4]||(o[4]=n=>i.imageData.opacity=n),type:"range",min:"0",max:"1",step:"0.01",class:"upd-slider"},null,512),[[t.vModelText,i.imageData.opacity,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[5]||(o[5]=n=>i.imageData.opacity=n),type:"number",min:"0",max:"1",step:"0.01",class:"upd-input-number"},null,512),[[t.vModelText,i.imageData.opacity,void 0,{number:!0}]])])])])])):t.createCommentVNode("",!0),t.createElementVNode("div",Xt,[t.createElementVNode("div",Zt,[o[22]||(o[22]=t.createElementVNode("span",{class:"upd-section-tools__title"},"内容块",-1)),t.createElementVNode("span",Qt," 样式ID "+t.toDisplayString(i.sectionData.id||"-"),1)]),t.createElementVNode("div",eo,[t.createElementVNode("div",to,[t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[6]||(o[6]=n=>r.$emit("action","clearFormat"))}," 清除样式 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[7]||(o[7]=n=>r.$emit("action","newSectionBefore"))}," 前空行 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[8]||(o[8]=n=>r.$emit("action","newSectionAfter"))}," 后空行 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[9]||(o[9]=n=>r.$emit("action","select"))}," 选中 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[10]||(o[10]=n=>r.$emit("action","delete"))}," 删除 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[11]||(o[11]=n=>r.$emit("action","moveUp"))}," 上移 "),t.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:o[12]||(o[12]=n=>r.$emit("action","moveDown"))}," 下移 ")]),t.createElementVNode("div",oo,[o[23]||(o[23]=t.createElementVNode("div",{class:"upd-section-tools__label"},"宽度%",-1)),t.createElementVNode("div",no,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[13]||(o[13]=n=>i.sectionData.width=n),type:"range",min:"0",max:"100",class:"upd-slider"},null,512),[[t.vModelText,i.sectionData.width,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[14]||(o[14]=n=>i.sectionData.width=n),type:"number",min:"0",max:"100",class:"upd-input-number"},null,512),[[t.vModelText,i.sectionData.width,void 0,{number:!0}]])])]),t.createElementVNode("div",ro,[o[24]||(o[24]=t.createElementVNode("div",{class:"upd-section-tools__label"},"旋转角度",-1)),t.createElementVNode("div",io,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[15]||(o[15]=n=>i.sectionData.rotate=n),type:"range",min:"-180",max:"180",class:"upd-slider"},null,512),[[t.vModelText,i.sectionData.rotate,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[16]||(o[16]=n=>i.sectionData.rotate=n),type:"number",min:"-180",max:"180",class:"upd-input-number"},null,512),[[t.vModelText,i.sectionData.rotate,void 0,{number:!0}]])])]),t.createElementVNode("div",ao,[o[25]||(o[25]=t.createElementVNode("div",{class:"upd-section-tools__label"},"透明度",-1)),t.createElementVNode("div",so,[t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[17]||(o[17]=n=>i.sectionData.opacity=n),type:"range",min:"0",max:"1",step:"0.01",class:"upd-slider"},null,512),[[t.vModelText,i.sectionData.opacity,void 0,{number:!0}]]),t.withDirectives(t.createElementVNode("input",{"onUpdate:modelValue":o[18]||(o[18]=n=>i.sectionData.opacity=n),type:"number",min:"0",max:"1",step:"0.01",class:"upd-input-number"},null,512),[[t.vModelText,i.sectionData.opacity,void 0,{number:!0}]])])])])])],4))}}),[["__scopeId","data-v-f465a212"]]),co=["width","height","stroke"],uo=ge(t.defineComponent({__name:"IconCheck",props:{size:{default:24},strokeColor:{default:"currentColor"}},setup(i){return(r,o)=>(t.openBlock(),t.createElementBlock("svg",{width:i.size,height:i.size,viewBox:"0 0 24 24",fill:"none",stroke:i.strokeColor,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon"},[...o[0]||(o[0]=[t.createElementVNode("polyline",{points:"20 6 9 17 4 12"},null,-1)])],8,co))}}),[["__scopeId","data-v-0ae058a4"]]),fo={class:"ueditor-plus-designer"},mo={class:"ueditor-plus-designer__body"},po={key:0,class:"ueditor-plus-designer__material"},ho={class:"ueditor-plus-designer__editor"},go={class:"upd-editor-instance"},yo=["id"],vo={key:0,class:"upd-toolbar"},Eo=t.defineComponent({__name:"Designer",props:{config:{default:()=>({})},isIframe:{type:Boolean,default:!1}},emits:["ready","change","confirm"],setup(i,{expose:r,emit:o}){const n=i,s=o,u=t.ref(null),w=t.ref(`upd_${Date.now()}`),d=t.ref(!0),l=t.ref(!1),p=t.ref({left:0,top:0}),{categories:f,materials:v,total:N,loading:I,loadingMore:W,currentCategory:Y,hasMore:fe,changeCategory:U,search:D,loadMore:j}=gt(n.config),{currentSection:C,sectionData:re,imageData:A,prepareSectionStyle:me,prepareImageStyle:$e,clearSelection:ye}=yt(),{clearSectionFormat:Ve,insertSection:ve,selectSection:Ee,deleteSection:H,moveSectionUp:q,moveSectionDown:Z}=vt();t.onMounted(async()=>{const h=document.getElementById(w.value);if(h){u.value=new ht({...n.config,container:h});try{await u.value.init(),u.value.on("ready",()=>{s("ready"),ie()}),u.value.on("change",_=>{s("change",_)}),u.value.on("section-click",we),window.addEventListener("resize",ie)}catch(_){console.error("Failed to initialize designer:",_)}}}),t.onUnmounted(()=>{var h;window.removeEventListener("resize",ie),(h=u.value)==null||h.destroy()});const _e=h=>{u.value&&u.value.insertSection(h.html,{id:h.id})},be=h=>{D(h)},we=({section:h,element:_,image:B})=>{C.value=h,me(h),B?$e(h,B):A.value.show=!1,l.value=!0,pe(h)},pe=h=>{if(!u.value)return;const _=u.value.getEditor();if(!_)return;const B=document.querySelector(`#${w.value}`);if(!B)return;const J=B.querySelector(".edui-editor-iframeholder > iframe");if(!J)return;const Q=_.document,T=Ce(h,J,Q),O=320,k=350,ee=J.getBoundingClientRect(),ae=document.querySelector(".ueditor-plus-designer"),he=ae==null?void 0:ae.getBoundingClientRect();if(!he)return;let G=ee.left-he.left-O;G=Math.max(0,G);let K;if(T.spaceTop>T.spaceBottom&&T.spaceTop>k)K=T.top-k-T.relativeTop,K=Math.max(0,K);else{K=T.top+T.height-T.relativeTop;const Oe=T.top+T.height+T.spaceBottom-T.relativeTop-k;K=Math.min(K,Oe)}p.value={left:G,top:K}},Ce=(h,_,B)=>{const J=document.querySelector(".ueditor-plus-designer");if(!J)return{left:0,top:0,width:0,height:0,containerWidth:0,containerHeight:0,spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,relativeLeft:0,relativeTop:0};const Q=_.getBoundingClientRect(),T=h.getBoundingClientRect(),O=J.getBoundingClientRect(),k={left:Q.left+T.left-B.documentElement.scrollLeft,top:Q.top+T.top-B.documentElement.scrollTop,width:T.width,height:T.height,containerWidth:O.width,containerHeight:O.height,spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,relativeLeft:O.left,relativeTop:O.top};return k.spaceTop=k.top-O.top,k.spaceLeft=k.left-O.left,k.spaceBottom=O.top+O.height-(k.top+k.height),k.spaceRight=O.left+O.width-(k.left+k.width),k},ie=()=>{l.value&&C.value&&pe(C.value)},z=()=>{C.value&&C.value.classList.remove(x.SectionActiveClass),l.value=!1,ye()},Se=h=>{if(!u.value||!C.value)return;const _=u.value.getEditor();if(_)switch(h){case"clearFormat":Ve(_,C.value),z();break;case"newSectionBefore":ve(_,C.value,"before"),z();break;case"newSectionAfter":ve(_,C.value,"after"),z();break;case"select":Ee(_,C.value),z();break;case"delete":H(_,C.value),z();break;case"moveUp":q(_,C.value),z();break;case"moveDown":Z(_,C.value),z();break}},Ne=h=>{console.log("Image action:",h)},Pe=()=>{if(u.value){const h=u.value.getContent();s("confirm",h)}};return r({getContent:()=>{var h;return((h=u.value)==null?void 0:h.getContent())||""},setContent:h=>{var _;(_=u.value)==null||_.setContent(h)}}),(h,_)=>(t.openBlock(),t.createElementBlock("div",fo,[t.createElementVNode("div",mo,[d.value?(t.openBlock(),t.createElementBlock("div",po,[t.createVNode(zt,{categories:t.unref(f),materials:t.unref(v),total:t.unref(N),"current-category":t.unref(Y),loading:t.unref(I),"loading-more":t.unref(W),"has-more":t.unref(fe),onSelect:_e,onChangeCategory:t.unref(U),onSearch:be,onLoadMore:t.unref(j)},null,8,["categories","materials","total","current-category","loading","loading-more","has-more","onChangeCategory","onLoadMore"])])):t.createCommentVNode("",!0),t.createElementVNode("div",ho,[t.createElementVNode("div",go,[t.createElementVNode("div",{id:w.value,style:{height:"100%"}},null,8,yo)]),i.isIframe?(t.openBlock(),t.createElementBlock("div",vo,[t.createElementVNode("a",{class:"upd-toolbar__item",href:"javascript:;",onClick:Pe},[t.createVNode(uo,{size:16}),_[0]||(_[0]=t.createTextVNode(" 完成 ",-1))])])):t.createCommentVNode("",!0)])]),l.value?(t.openBlock(),t.createBlock(lo,{key:0,"section-data":t.unref(re),"image-data":t.unref(A),position:p.value,onAction:Se,onImageAction:Ne,onClose:z},null,8,["section-data","image-data","position"])):t.createCommentVNode("",!0)]))}}),_o=oe.applyVueInReact(Eo),We=$.forwardRef((i,r)=>{const o=$.useRef(null);return $.useImperativeHandle(r,()=>({getContent:()=>{const n=o.current;return n?n.__veauryVueRef__&&typeof n.__veauryVueRef__.getContent=="function"?n.__veauryVueRef__.getContent():typeof n.getContent=="function"?n.getContent():n.$refs&&n.$refs.component&&typeof n.$refs.component.getContent=="function"?n.$refs.component.getContent():n.exposed&&typeof n.exposed.getContent=="function"?n.exposed.getContent():n.$exposed&&typeof n.$exposed.getContent=="function"?n.$exposed.getContent():(console.error("Cannot find getContent method in:",n),console.error("Available properties:",Object.keys(n)),""):""},setContent:n=>{const s=o.current;if(s){if(s.__veauryVueRef__&&typeof s.__veauryVueRef__.setContent=="function"){s.__veauryVueRef__.setContent(n);return}typeof s.setContent=="function"?s.setContent(n):s.$refs&&s.$refs.component&&typeof s.$refs.component.setContent=="function"?s.$refs.component.setContent(n):s.exposed&&typeof s.exposed.setContent=="function"?s.exposed.setContent(n):s.$exposed&&typeof s.$exposed.setContent=="function"?s.$exposed.setContent(n):(console.error("Cannot find setContent method in:",s),console.error("Available properties:",Object.keys(s)))}}})),at.jsx(_o,{ref:o,...i})});V.UEditorPlusDesigner=We,V.default=We,Object.defineProperties(V,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
