(function(g,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(g=typeof globalThis<"u"?globalThis:g||self,e(g.UEditorPlusDesignerVue={},g.Vue))})(this,function(g,e){"use strict";var kt=Object.defineProperty;var vt=(g,e,$)=>e in g?kt(g,e,{enumerable:!0,configurable:!0,writable:!0,value:$}):g[e]=$;var C=(g,e,$)=>vt(g,typeof e!="symbol"?e+"":e,$);const $="https://paiban.tecmz.com/api/live_rich_editor";async function ie(){var n;try{const o=await fetch(`${$}/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();if(t.code!==0||!((n=t.data)!=null&&n.tree))throw new Error(t.msg||"Failed to fetch categories");return W(t.data.tree)}catch(o){return console.error("Failed to fetch categories:",o),[]}}function W(n){return n.map(o=>({id:o.id,title:o.title,pid:o.pid,sort:o.sort||0,_child:o._child?W(o._child):void 0}))}async function se(n){try{const o={paginate:{page:(n==null?void 0:n.page)||1,pageSize:(n==null?void 0:n.pageSize)||100,search:{}}};n!=null&&n.categoryId&&(o.paginate.search.categoryId=n.categoryId),n!=null&&n.keywords&&(o.paginate.search.keywords=n.keywords);const t=await fetch(`${$}/paginate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();if(i.code!==0||!i.data)throw new Error(i.msg||"Failed to fetch materials");return i.data}catch(o){return console.error("Failed to fetch materials:",o),{page:1,pageSize:(n==null?void 0:n.pageSize)||10,total:0,records:[]}}}function le(n){return n.map(o=>({...o,id:o.id,title:o.title,html:o.html}))}async function ae(){try{return await ie()}catch(n){return console.error("Default category loader error:",n),[]}}async function re(n){try{const o=await se(n);return{records:le(o.records),total:o.total,page:o.page,pageSize:o.pageSize}}catch(o){return console.error("Default style loader error:",o),{records:[],total:0,page:1,pageSize:(n==null?void 0:n.pageSize)||100}}}const w={SectionClass:"pb-section",SectionActiveClass:"pb-section-active",SectionHoverClass:"pb-section-hover",DefaultCategoryLoader:ae,DefaultStyleLoader:re},ce=[["source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","insertimage","emotion","scrawl","insertvideo","attachment","map","insertframe","insertcode","pagebreak","template","background","|","horizontal","date","time","spechars","wordimage","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","print","preview","searchreplace","shortcutmenu"]];let z=!1,J=!1;const A=[];function de(n="/ueditor-plus"){return new Promise((o,t)=>{if(J&&window.UE){o(window.UE);return}if(z){A.push(()=>o(window.UE));return}z=!0;const i=n.endsWith("/")?n:`${n}/`;window.UEDITOR_HOME_URL=i;const s=document.createElement("script");s.src=`${i}ueditor.config.js`,s.onload=()=>{const r=document.createElement("script");r.src=`${i}ueditor.all.js`,r.onload=()=>{J=!0,z=!1,A.forEach(h=>h()),A.length=0,o(window.UE)},r.onerror=()=>{z=!1,t(new Error("Failed to load UEditor main script"))},document.head.appendChild(r)},s.onerror=()=>{z=!1,t(new Error("Failed to load UEditor config script"))},document.head.appendChild(s)})}const me=`
/* Section基础样式 */
section.pb-section {
  position: relative;
  margin: 10px auto;
  padding: 0;
  transition: all 0.2s;
  cursor: pointer;
  min-height: 20px;
}

/* Section激活状态 */
section.pb-section.pb-section-active {
  outline: 2px dashed rgba(255, 0, 0, 0.4);
  outline-offset: 2px;
}

/* 子Section悬停状态 */
section.pb-section .pb-section-hover {
  outline: 1px dashed rgba(0, 0, 255, 0.3);
  outline-offset: 1px;
}

/* 子Section激活状态 */
section.pb-section .pb-section-active {
  outline: 1px dashed rgba(0, 0, 255, 0.5);
  outline-offset: 1px;
}

/* 子Section样式 */
section:not(.pb-section) {
  position: relative;
  transition: all 0.2s;
}

section:not(.pb-section).pb-section-hover {
  outline: 1px dashed rgba(0, 0, 255, 0.3);
  outline-offset: 1px;
}

/* 图片样式增强 */
section.pb-section img {
  max-width: 100%;
  height: auto;
  display: block;
  transition: all 0.2s;
}

section.pb-section img:hover {
  opacity: 0.9;
  cursor: pointer;
}

/* 表格样式优化 */
section.pb-section table {
  border-collapse: collapse;
  width: 100%;
  margin: 10px 0;
}

section.pb-section table td,
section.pb-section table th {
  border: 1px solid #ddd;
  padding: 8px;
}

section.pb-section table th {
  background: #f5f5f5;
  font-weight: bold;
}

/* 防止内容溢出 */
section.pb-section {
  overflow: hidden;
  word-wrap: break-word;
}

/* 空Section提示 */
section.pb-section:empty::before {
  content: '空内容块 - 点击编辑';
  color: #999;
  font-size: 14px;
}
`;class ue{constructor(o){C(this,"config");C(this,"container",null);C(this,"editor",null);C(this,"editorId");C(this,"eventHandlers",new Map);C(this,"resizeHandler",null);C(this,"editorElement",null);const t=o.ueditorConfig||{};t.iframeCssStylesAddition||(t.iframeCssStylesAddition=[]),t.iframeCssStylesAddition=[me,...t.iframeCssStylesAddition],t.toolbars||(t.toolbars=ce),t.toolbars[t.toolbars.length-1].push("liveeditor");let i=o.categoryLoader||w.DefaultCategoryLoader,s=o.styleLoader||w.DefaultStyleLoader;this.config={container:o.container||"#editor",ueditorPath:o.ueditorPath||"/ueditor-plus",ueditorConfig:t,categoryLoader:i,styleLoader:s,onReady:o.onReady||(()=>{}),onChange:o.onChange||(()=>{})},this.editorId=`ueditorPlusDesigner_${Date.now()}`}async init(){if(typeof this.config.container=="string"?this.container=document.querySelector(this.config.container):this.container=this.config.container,!this.container)throw new Error("Container not found");await de(this.config.ueditorPath);const o=window.UE;if(!o)throw new Error("UEditor failed to load");const t=document.createElement("div");t.id=this.editorId,this.container.appendChild(t),this.editorElement=t,this.registerUIPlugin();const i={autoHeightEnabled:!1,initialFrameWidth:"100%",...this.config.ueditorConfig};this.editor=o.getEditor(this.editorId,i),this.editor.ready(()=>{this.setupResizeListener(),this.doLayout(),this.config.onReady(),this.emit("ready")}),this.editor.addListener("contentChange",()=>{const s=this.getContent();this.config.onChange(s),this.emit("change",s)})}registerUIPlugin(){window.UE.registerUI("liveeditor",(t,i)=>{t.on("click",(s,r)=>{const h=r.target,a=h.closest(`.${w.SectionClass}`);if(!a||(t.document.querySelectorAll(`.${w.SectionClass}`).forEach(k=>{k.classList.remove(w.SectionActiveClass)}),a.classList.add(w.SectionActiveClass),t.selection.getText()))return;let c=null;const u=t.selection.getRange().getClosedNode();u&&u.tagName&&u.tagName.toLowerCase()==="img"&&(c=u),this.emit("section-click",{section:a,element:h,image:c})}),t.addListener("mouseover mouseout",(s,r)=>{const h=r.target;if(t.document.querySelectorAll(`section:not(.${w.SectionClass})`).forEach(l=>{l.classList.remove(w.SectionHoverClass)}),!h.classList.contains(w.SectionClass)){const l=h.closest(`section:not(.${w.SectionClass})`);s==="mouseover"&&l&&l.classList.add(w.SectionHoverClass)}})})}getContent(){var o;return((o=this.editor)==null?void 0:o.getContent())||""}setContent(o){var t;(t=this.editor)==null||t.setContent(o)}insertSection(o,t){if(!this.editor)return;const i=(t==null?void 0:t.id)||"",s=`<section class="${w.SectionClass} ${w.SectionActiveClass}" data-section-id="${i}">${o}</section>`;this.editor.execCommand("insertHtml",s)}doLayout(){if(!this.container||!this.editor||!this.editorElement)return;const o=this.container.clientHeight,t=this.editorElement.querySelector(".edui-editor-toolbarbox"),i=t?t.offsetHeight:0,s=o-i;this.editor.setHeight(Math.max(s,100))}setupResizeListener(){let o=null;this.resizeHandler=()=>{o!==null&&window.clearTimeout(o),o=window.setTimeout(()=>{this.doLayout()},150)},window.addEventListener("resize",this.resizeHandler)}destroy(){var o;this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),(o=this.editor)==null||o.destroy(),this.editor=null,this.eventHandlers.clear()}on(o,t){this.eventHandlers.has(o)||this.eventHandlers.set(o,[]),this.eventHandlers.get(o).push(t)}off(o,t){if(!t){this.eventHandlers.delete(o);return}const i=this.eventHandlers.get(o);if(i){const s=i.indexOf(t);s>-1&&i.splice(s,1)}}emit(o,...t){const i=this.eventHandlers.get(o);i&&i.forEach(s=>s(...t))}getEditor(){return this.editor}}function Z(n){const o=e.ref([]),t=e.ref([]),i=e.ref(0),s=e.ref(!1),r=e.ref(!1),h=e.ref(!1),a=e.ref(0),l=e.ref(""),d=e.ref(1),c=e.ref(100),u=e.ref(!0),k=()=>n.categoryLoader?n.categoryLoader:w.DefaultCategoryLoader,L=()=>n.styleLoader?n.styleLoader:w.DefaultStyleLoader,M=async()=>{const b=k();if(b){h.value=!0;try{o.value=await b()}catch(y){console.error("Failed to load categories:",y),o.value=[]}finally{h.value=!1}}},D=async(b,y=!1)=>{const U=L();if(U){y?r.value=!0:s.value=!0;try{const _=await U({categoryId:a.value,keywords:l.value,page:d.value,pageSize:c.value,...b});y?t.value=[...t.value,..._.records]:t.value=_.records,i.value=_.total,c.value=_.pageSize;const q=Math.ceil(_.total/c.value);u.value=d.value<q}catch(_){console.error("Failed to load materials:",_),y||(t.value=[],i.value=0,u.value=!1)}finally{y?r.value=!1:s.value=!1}}},P=async()=>{r.value||!u.value||(d.value++,await D(void 0,!0))},F=b=>{a.value=b,d.value=1,u.value=!0,D()},j=b=>{l.value=b,d.value=1,u.value=!0,D()};return e.onMounted(async()=>{await M(),await D()}),{categories:o,materials:t,total:i,loading:s,loadingMore:r,loadingCategories:h,currentCategory:a,keywords:l,currentPage:d,hasMore:u,loadMaterials:D,loadMore:P,changeCategory:F,search:j}}const B=class B{constructor(){C(this,"element",null);C(this,"styles",{})}dom(o){return this.element=o,this.parse(),this}parse(){if(this.styles={},!this.element)return this;const o=this.element.getAttribute("style");if(o){const t=o.split(";");for(const i of t){if(!i.trim())continue;const[s,r]=i.split(":").map(h=>h.trim());s&&r&&(this.styles[s]=r)}}return this}remove(o){return o in this.styles&&delete this.styles[o],this}removeDomAttr(o){var t;return(t=this.element)==null||t.removeAttribute(o),this}getStyleKeys(o){const t=[];for(const i of B.prefixes){const s=`${i}${o}`;if(s in this.styles){t.push(s);break}}return t.length?t:[o]}setStyleValues(o,t){const i=this.getStyleKeys(o);if(!i.length)this.styles[o]=t("");else for(const s of i){const r=this.styles[s]||"";this.styles[s]=t(r)}}merge(o,t){if(o==="rotatez"){const i=`rotatez(${t}deg)`;this.setStyleValues("transform",s=>/rotatez\(.*?\)/.test(s)?s.replace(/rotatez\(.*?\)/,i):s?`${s} ${i}`:i)}else{this.styles[o]=String(t);for(const i of B.prefixes){const s=`${i}${o}`;s in this.styles&&(this.styles[s]=String(t))}}return this}get(o,t=null){if(!this.element)return t;switch(o){case"opacity":{let i=this.element.style.opacity;if(!i)for(const s of B.prefixes){const r=`${s}${o}`;if(r in this.styles){i=this.styles[r];break}}return i?parseFloat(i):t}case"rotatez":{const i=this.element.style.transform||"";let s=0;if(i.toLowerCase().indexOf("rotatez(")>=0){const r=i.toLowerCase().replace(/rotatex\s*\(\s*[0-9\-]*\s*deg\s*\)/g,"").replace(/rotatey\s*\(\s*[0-9\-]*\s*deg\s*\)/g,"").match(/rotatez\s*\(\s*([0-9\-]+)\s*deg\s*\)/);r&&(s=parseInt(r[1]),s>180?s-=360:s<-180&&(s+=360))}return s}default:return this.styles[o]||t}}toDom(){if(!this.element)return this;const o=[];for(const t in this.styles)o.push(`${t}:${this.styles[t]}`);return o.length?this.element.setAttribute("style",o.join(";")):this.element.removeAttribute("style"),this}};C(B,"prefixes",["-moz-","-o-","-webkit-","-ms-"]);let R=B;const N={fromDom(n){return new R().dom(n)}};function G(){const n=e.ref(null),o=e.ref(null),t=e.ref({id:"",width:100,rotate:0,opacity:1}),i=e.ref({show:!1,element:null,width:100,opacity:1}),s=a=>{n.value=a,t.value.id=a.getAttribute("data-section-id")||"";const l=N.fromDom(a),d=a.style.width||"100%";t.value.width=parseInt(d)||100,t.value.rotate=l.get("rotatez",0),t.value.opacity=l.get("opacity",1)},r=(a,l)=>{i.value.element=l,i.value.show=!0,n.value=a;const d=N.fromDom(l),c=l.style.width||"100%";i.value.width=parseInt(c)||100,i.value.opacity=d.get("opacity",1)},h=()=>{n.value=null,o.value=null,i.value.show=!1,i.value.element=null};return e.watch(()=>t.value.width,a=>{n.value&&N.fromDom(n.value).merge("margin","0 auto").merge("width",`${a}%`).toDom().remove("max-width").removeDomAttr("width")}),e.watch(()=>t.value.rotate,a=>{n.value&&N.fromDom(n.value).merge("rotatez",a).toDom()}),e.watch(()=>t.value.opacity,a=>{n.value&&N.fromDom(n.value).merge("opacity",a).toDom()}),e.watch(()=>i.value.width,a=>{i.value.element&&N.fromDom(i.value.element).remove("max-width").merge("width",`${a}%`).toDom().removeDomAttr("width")}),e.watch(()=>i.value.opacity,a=>{i.value.element&&N.fromDom(i.value.element).merge("opacity",a).toDom()}),{currentSection:n,currentElement:o,sectionData:t,imageData:i,prepareSectionStyle:s,prepareImageStyle:r,clearSelection:h}}function fe(){const n=(a,l)=>{a&&(a.undoManger.save(),l(),a.undoManger.save(),a.syncCommandState())};return{clearSectionFormat:(a,l)=>{!a||!l||n(a,()=>{a.selection.getRange().selectNode(l).select(),a.execCommand("removeformat"),l.className=`${w.SectionClass} ${w.SectionActiveClass}`})},insertSection:(a,l,d)=>{if(!a||!l)return;const c=document.createElement("section");c.className=w.SectionClass,c.setAttribute("data-section-id","");const u=document.createElement("p"),k=document.createElement("br");u.appendChild(k),c.appendChild(u),n(a,()=>{var L,M;d==="before"?(L=l.parentNode)==null||L.insertBefore(c,l):(M=l.parentNode)==null||M.insertBefore(c,l.nextSibling)}),a.selection.getRange().setStart(u,0).setCursor(!1,!0)},selectSection:(a,l)=>{!a||!l||n(a,()=>{a.selection.getRange().selectNode(l).select()})},deleteSection:(a,l)=>{!a||!l||n(a,()=>{l.remove()})},moveSectionUp:(a,l)=>{if(!a||!l)return;const d=l.previousElementSibling;d&&n(a,()=>{var c;(c=l.parentNode)==null||c.insertBefore(l,d)})},moveSectionDown:(a,l)=>{if(!a||!l)return;const d=l.nextElementSibling;d&&n(a,()=>{var c;(c=l.parentNode)==null||c.insertBefore(l,d.nextSibling)})}}}const he={class:"upd-material-panel"},pe={class:"upd-material-body"},ge={class:"upd-material-item"},ye={class:"upd-material-item__head"},we={class:"upd-category"},Ee={class:"upd-category__item"},Se=["onClick"],Ce={key:0,class:"upd-category__children"},be=["onClick"],_e={class:"upd-filter"},ke={class:"upd-filter__search"},ve={class:"upd-material-item__body"},Ve={key:0,class:"upd-loading"},$e={key:1,class:"upd-material-list"},Ne=["onClick"],De=["innerHTML"],xe={class:"upd-material-list__info"},Be={class:"upd-material-list__title"},Le={class:"upd-material-list__id"},Me={key:0,class:"upd-loading-more"},ze={key:1,class:"upd-no-more"},Te=e.defineComponent({__name:"MaterialPanel",props:{categories:{},materials:{},total:{},currentCategory:{},loading:{type:Boolean,default:!1},loadingMore:{type:Boolean,default:!1},hasMore:{type:Boolean,default:!0}},emits:["select","change-category","search","load-more"],setup(n,{emit:o}){const t=n,i=o,s=e.ref(""),r=e.ref(null),h=()=>{i("search",s.value)},a=()=>{if(!r.value||t.loading||t.loadingMore||!t.hasMore)return;const l=r.value,d=l.scrollTop,c=l.scrollHeight,u=l.clientHeight;d+u>=c-50&&i("load-more")};return e.onMounted(()=>{r.value=document.querySelector(".upd-material-item"),r.value&&r.value.addEventListener("scroll",a)}),e.onUnmounted(()=>{r.value&&r.value.removeEventListener("scroll",a)}),(l,d)=>(e.openBlock(),e.createElementBlock("div",he,[e.createElementVNode("div",pe,[e.createElementVNode("div",ge,[e.createElementVNode("div",ye,[e.createElementVNode("div",we,[e.createElementVNode("div",Ee,[e.createElementVNode("div",{class:e.normalizeClass(["upd-category__title",{"upd-category__title--active":n.currentCategory===0}]),onClick:d[0]||(d[0]=c=>l.$emit("change-category",0))}," 全部 ",2)]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.categories,c=>(e.openBlock(),e.createElementBlock("div",{key:c.id,class:"upd-category__item"},[e.createElementVNode("div",{class:e.normalizeClass(["upd-category__title",{"upd-category__title--active":c.id===n.currentCategory||c._child&&c._child.some(u=>u.id===n.currentCategory)}]),onClick:u=>l.$emit("change-category",c.id)},e.toDisplayString(c.title),11,Se),c._child&&c._child.length?(e.openBlock(),e.createElementBlock("div",Ce,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c._child,u=>(e.openBlock(),e.createElementBlock("div",{key:u.id,class:e.normalizeClass(["upd-category__child-title",{"upd-category__child-title--active":u.id===n.currentCategory}]),onClick:e.withModifiers(k=>l.$emit("change-category",u.id),["stop"])},e.toDisplayString(u.title),11,be))),128))])):e.createCommentVNode("",!0)]))),128))]),e.createElementVNode("div",_e,[d[2]||(d[2]=e.createElementVNode("div",{class:"upd-filter__text"},null,-1)),e.createElementVNode("div",ke,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":d[1]||(d[1]=c=>s.value=c),type:"text",placeholder:"样式ID或关键词",onKeyup:e.withKeys(h,["enter"])},null,544),[[e.vModelText,s.value]])])])]),e.createElementVNode("div",ve,[n.loading?(e.openBlock(),e.createElementBlock("div",Ve," 加载中... ")):(e.openBlock(),e.createElementBlock("div",$e,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.materials,c=>(e.openBlock(),e.createElementBlock("div",{key:c.id,class:"upd-material-list__item",onClick:u=>l.$emit("select",c)},[e.createElementVNode("div",{class:"upd-material-list__preview",innerHTML:c.html},null,8,De),e.createElementVNode("div",xe,[e.createElementVNode("span",Be,e.toDisplayString(c.title),1),e.createElementVNode("span",Le,"ID: "+e.toDisplayString(c.id),1)])],8,Ne))),128)),n.loadingMore?(e.openBlock(),e.createElementBlock("div",Me," 加载更多... ")):!n.hasMore&&n.materials.length>0?(e.openBlock(),e.createElementBlock("div",ze," 没有更多数据了 ")):e.createCommentVNode("",!0)]))])])])]))}}),I=(n,o)=>{const t=n.__vccOpts||n;for(const[i,s]of o)t[i]=s;return t},Q=I(Te,[["__scopeId","data-v-797b48ca"]]),Ie=["width","height","stroke"],X=I(e.defineComponent({__name:"IconClose",props:{size:{default:24},strokeColor:{default:"currentColor"}},setup(n){return(o,t)=>(e.openBlock(),e.createElementBlock("svg",{width:n.size,height:n.size,viewBox:"0 0 24 24",fill:"none",stroke:n.strokeColor,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon"},[...t[0]||(t[0]=[e.createElementVNode("line",{x1:"18",y1:"6",x2:"6",y2:"18"},null,-1),e.createElementVNode("line",{x1:"6",y1:"6",x2:"18",y2:"18"},null,-1)])],8,Ie))}}),[["__scopeId","data-v-218750c8"]]),Ue={key:0,class:"upd-section-tools__panel"},He={class:"upd-section-tools__body"},Ae={class:"upd-section-tools__actions"},Re={class:"upd-section-tools__line"},Pe={class:"upd-section-tools__field"},Fe={class:"upd-section-tools__line"},je={class:"upd-section-tools__field"},qe={class:"upd-section-tools__panel"},Ke={class:"upd-section-tools__head"},Oe={class:"upd-section-tools__desc"},We={class:"upd-section-tools__body"},Je={class:"upd-section-tools__actions"},Ze={class:"upd-section-tools__line"},Ge={class:"upd-section-tools__field"},Qe={class:"upd-section-tools__line"},Xe={class:"upd-section-tools__field"},Ye={class:"upd-section-tools__line"},et={class:"upd-section-tools__field"},Y=I(e.defineComponent({__name:"SectionTools",props:{sectionData:{},imageData:{},position:{}},emits:["action","image-action","close"],setup(n){return(o,t)=>(e.openBlock(),e.createElementBlock("div",{class:"upd-section-tools",style:e.normalizeStyle({left:n.position.left+"px",top:n.position.top+"px"})},[e.createElementVNode("div",{class:"upd-section-tools__close",onClick:t[0]||(t[0]=i=>o.$emit("close"))},[e.createVNode(X,{size:16,"stroke-color":"#fff"})]),n.imageData.show?(e.openBlock(),e.createElementBlock("div",Ue,[t[21]||(t[21]=e.createElementVNode("div",{class:"upd-section-tools__head"},[e.createElementVNode("span",{class:"upd-section-tools__title"},"图片")],-1)),e.createElementVNode("div",He,[e.createElementVNode("div",Ae,[e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[1]||(t[1]=i=>o.$emit("image-action","change"))}," 换图 ")]),e.createElementVNode("div",Re,[t[19]||(t[19]=e.createElementVNode("div",{class:"upd-section-tools__label"},"宽度%",-1)),e.createElementVNode("div",Pe,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>n.imageData.width=i),type:"range",min:"0",max:"100",class:"upd-slider"},null,512),[[e.vModelText,n.imageData.width,void 0,{number:!0}]]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>n.imageData.width=i),type:"number",min:"0",max:"100",class:"upd-input-number"},null,512),[[e.vModelText,n.imageData.width,void 0,{number:!0}]])])]),e.createElementVNode("div",Fe,[t[20]||(t[20]=e.createElementVNode("div",{class:"upd-section-tools__label"},"透明度",-1)),e.createElementVNode("div",je,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>n.imageData.opacity=i),type:"range",min:"0",max:"1",step:"0.01",class:"upd-slider"},null,512),[[e.vModelText,n.imageData.opacity,void 0,{number:!0}]]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>n.imageData.opacity=i),type:"number",min:"0",max:"1",step:"0.01",class:"upd-input-number"},null,512),[[e.vModelText,n.imageData.opacity,void 0,{number:!0}]])])])])])):e.createCommentVNode("",!0),e.createElementVNode("div",qe,[e.createElementVNode("div",Ke,[t[22]||(t[22]=e.createElementVNode("span",{class:"upd-section-tools__title"},"内容块",-1)),e.createElementVNode("span",Oe," 样式ID "+e.toDisplayString(n.sectionData.id||"-"),1)]),e.createElementVNode("div",We,[e.createElementVNode("div",Je,[e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[6]||(t[6]=i=>o.$emit("action","clearFormat"))}," 清除样式 "),e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[7]||(t[7]=i=>o.$emit("action","newSectionBefore"))}," 前空行 "),e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[8]||(t[8]=i=>o.$emit("action","newSectionAfter"))}," 后空行 "),e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[9]||(t[9]=i=>o.$emit("action","select"))}," 选中 "),e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[10]||(t[10]=i=>o.$emit("action","delete"))}," 删除 "),e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[11]||(t[11]=i=>o.$emit("action","moveUp"))}," 上移 "),e.createElementVNode("div",{class:"upd-section-tools__action-btn",onClick:t[12]||(t[12]=i=>o.$emit("action","moveDown"))}," 下移 ")]),e.createElementVNode("div",Ze,[t[23]||(t[23]=e.createElementVNode("div",{class:"upd-section-tools__label"},"宽度%",-1)),e.createElementVNode("div",Ge,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[13]||(t[13]=i=>n.sectionData.width=i),type:"range",min:"0",max:"100",class:"upd-slider"},null,512),[[e.vModelText,n.sectionData.width,void 0,{number:!0}]]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[14]||(t[14]=i=>n.sectionData.width=i),type:"number",min:"0",max:"100",class:"upd-input-number"},null,512),[[e.vModelText,n.sectionData.width,void 0,{number:!0}]])])]),e.createElementVNode("div",Qe,[t[24]||(t[24]=e.createElementVNode("div",{class:"upd-section-tools__label"},"旋转角度",-1)),e.createElementVNode("div",Xe,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[15]||(t[15]=i=>n.sectionData.rotate=i),type:"range",min:"-180",max:"180",class:"upd-slider"},null,512),[[e.vModelText,n.sectionData.rotate,void 0,{number:!0}]]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[16]||(t[16]=i=>n.sectionData.rotate=i),type:"number",min:"-180",max:"180",class:"upd-input-number"},null,512),[[e.vModelText,n.sectionData.rotate,void 0,{number:!0}]])])]),e.createElementVNode("div",Ye,[t[25]||(t[25]=e.createElementVNode("div",{class:"upd-section-tools__label"},"透明度",-1)),e.createElementVNode("div",et,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[17]||(t[17]=i=>n.sectionData.opacity=i),type:"range",min:"0",max:"1",step:"0.01",class:"upd-slider"},null,512),[[e.vModelText,n.sectionData.opacity,void 0,{number:!0}]]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[18]||(t[18]=i=>n.sectionData.opacity=i),type:"number",min:"0",max:"1",step:"0.01",class:"upd-input-number"},null,512),[[e.vModelText,n.sectionData.opacity,void 0,{number:!0}]])])])])])],4))}}),[["__scopeId","data-v-f465a212"]]),tt=["width","height","stroke"],ee=I(e.defineComponent({__name:"IconCheck",props:{size:{default:24},strokeColor:{default:"currentColor"}},setup(n){return(o,t)=>(e.openBlock(),e.createElementBlock("svg",{width:n.size,height:n.size,viewBox:"0 0 24 24",fill:"none",stroke:n.strokeColor,"stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"icon"},[...t[0]||(t[0]=[e.createElementVNode("polyline",{points:"20 6 9 17 4 12"},null,-1)])],8,tt))}}),[["__scopeId","data-v-0ae058a4"]]),ot={class:"ueditor-plus-designer"},nt={class:"ueditor-plus-designer__body"},it={key:0,class:"ueditor-plus-designer__material"},st={class:"ueditor-plus-designer__editor"},lt={class:"upd-editor-instance"},at=["id"],rt={key:0,class:"upd-toolbar"},te=e.defineComponent({__name:"Designer",props:{config:{default:()=>({})},isIframe:{type:Boolean,default:!1}},emits:["ready","change","confirm"],setup(n,{expose:o,emit:t}){const i=n,s=t,r=e.ref(null),h=e.ref(`upd_${Date.now()}`),a=e.ref(!0),l=e.ref(!1),d=e.ref({left:0,top:0}),{categories:c,materials:u,total:k,loading:L,loadingMore:M,currentCategory:D,hasMore:P,changeCategory:F,search:j,loadMore:b}=Z(i.config),{currentSection:y,sectionData:U,imageData:_,prepareSectionStyle:q,prepareImageStyle:ct,clearSelection:dt}=G(),{clearSectionFormat:mt,insertSection:oe,selectSection:ut,deleteSection:ft,moveSectionUp:ht,moveSectionDown:pt}=fe();e.onMounted(async()=>{const m=document.getElementById(h.value);if(m){r.value=new ue({...i.config,container:m});try{await r.value.init(),r.value.on("ready",()=>{s("ready"),K()}),r.value.on("change",f=>{s("change",f)}),r.value.on("section-click",wt),window.addEventListener("resize",K)}catch(f){console.error("Failed to initialize designer:",f)}}}),e.onUnmounted(()=>{var m;window.removeEventListener("resize",K),(m=r.value)==null||m.destroy()});const gt=m=>{r.value&&r.value.insertSection(m.html,{id:m.id})},yt=m=>{j(m)},wt=({section:m,element:f,image:V})=>{y.value=m,q(m),V?ct(m,V):_.value.show=!1,l.value=!0,ne(m)},ne=m=>{if(!r.value)return;const f=r.value.getEditor();if(!f)return;const V=document.querySelector(`#${h.value}`);if(!V)return;const T=V.querySelector(".edui-editor-iframeholder > iframe");if(!T)return;const H=f.document,p=Et(m,T,H),S=320,E=350;let O=p.left+(p.width-S)/2-p.relativeLeft;O=Math.max(0,Math.min(O,p.containerWidth-S));let x;if(p.spaceTop>p.spaceBottom&&p.spaceTop>E)x=p.top-E-p.relativeTop,x=Math.max(0,x);else{x=p.top+p.height-p.relativeTop;const _t=p.top+p.height+p.spaceBottom-p.relativeTop-E;x=Math.min(x,_t)}d.value={left:O,top:x}},Et=(m,f,V)=>{const T=document.querySelector(".ueditor-plus-designer");if(!T)return{left:0,top:0,width:0,height:0,containerWidth:0,containerHeight:0,spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,relativeLeft:0,relativeTop:0};const H=f.getBoundingClientRect(),p=m.getBoundingClientRect(),S=T.getBoundingClientRect(),E={left:H.left+p.left-V.documentElement.scrollLeft,top:H.top+p.top-V.documentElement.scrollTop,width:p.width,height:p.height,containerWidth:S.width,containerHeight:S.height,spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,relativeLeft:S.left,relativeTop:S.top};return E.spaceTop=E.top-S.top,E.spaceLeft=E.left-S.left,E.spaceBottom=S.top+S.height-(E.top+E.height),E.spaceRight=S.left+S.width-(E.left+E.width),E},K=()=>{l.value&&y.value&&ne(y.value)},v=()=>{y.value&&y.value.classList.remove(w.SectionActiveClass),l.value=!1,dt()},St=m=>{if(!r.value||!y.value)return;const f=r.value.getEditor();if(f)switch(m){case"clearFormat":mt(f,y.value),v();break;case"newSectionBefore":oe(f,y.value,"before"),v();break;case"newSectionAfter":oe(f,y.value,"after"),v();break;case"select":ut(f,y.value),v();break;case"delete":ft(f,y.value),v();break;case"moveUp":ht(f,y.value),v();break;case"moveDown":pt(f,y.value),v();break}},Ct=m=>{console.log("Image action:",m)},bt=()=>{if(r.value){const m=r.value.getContent();s("confirm",m)}};return o({getContent:()=>{var m;return((m=r.value)==null?void 0:m.getContent())||""},setContent:m=>{var f;(f=r.value)==null||f.setContent(m)}}),(m,f)=>(e.openBlock(),e.createElementBlock("div",ot,[e.createElementVNode("div",nt,[a.value?(e.openBlock(),e.createElementBlock("div",it,[e.createVNode(Q,{categories:e.unref(c),materials:e.unref(u),total:e.unref(k),"current-category":e.unref(D),loading:e.unref(L),"loading-more":e.unref(M),"has-more":e.unref(P),onSelect:gt,onChangeCategory:e.unref(F),onSearch:yt,onLoadMore:e.unref(b)},null,8,["categories","materials","total","current-category","loading","loading-more","has-more","onChangeCategory","onLoadMore"])])):e.createCommentVNode("",!0),e.createElementVNode("div",st,[e.createElementVNode("div",lt,[e.createElementVNode("div",{id:h.value,style:{height:"100%"}},null,8,at)]),n.isIframe?(e.openBlock(),e.createElementBlock("div",rt,[e.createElementVNode("a",{class:"upd-toolbar__item",href:"javascript:;",onClick:bt},[e.createVNode(ee,{size:16}),f[0]||(f[0]=e.createTextVNode(" 完成 ",-1))])])):e.createCommentVNode("",!0)])]),l.value?(e.openBlock(),e.createBlock(Y,{key:0,"section-data":e.unref(U),"image-data":e.unref(_),position:d.value,onAction:St,onImageAction:Ct,onClose:v},null,8,["section-data","image-data","position"])):e.createCommentVNode("",!0)]))}});g.IconCheck=ee,g.IconClose=X,g.MaterialPanel=Q,g.SectionTools=Y,g.UEditorPlusDesigner=te,g.default=te,g.useMaterial=Z,g.useSection=G,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
